"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/page",{

/***/ "(app-pages-browser)/./src/components/LivePreview.tsx":
/*!****************************************!*\
  !*** ./src/components/LivePreview.tsx ***!
  \****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-dev-runtime */ \"(app-pages-browser)/./node_modules/next/dist/compiled/react/jsx-dev-runtime.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(app-pages-browser)/./node_modules/next/dist/compiled/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var lodash_debounce__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! lodash/debounce */ \"(app-pages-browser)/./node_modules/lodash/debounce.js\");\n/* harmony import */ var lodash_debounce__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(lodash_debounce__WEBPACK_IMPORTED_MODULE_2__);\n/* __next_internal_client_entry_do_not_use__ default auto */ \nvar _s = $RefreshSig$();\n\n\nconst LivePreview = (param)=>{\n    let { pages, currentPage, onPageChange, onFileUpload } = param;\n    _s();\n    const [localPage, setLocalPage] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(currentPage);\n    const [isLoading, setIsLoading] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(true);\n    const [isDragOver, setIsDragOver] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(false);\n    const [error, setError] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\n    const [lastValidHTML, setLastValidHTML] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\n    const iframeRef = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null);\n    const dropZoneRef = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null);\n    // Gestion des images\n    const handleImageUpload = ()=>{\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.accept = 'image/*';\n        input.multiple = true;\n        input.onchange = async (event)=>{\n            const files = event.target.files;\n            if (!files || files.length === 0) return;\n            try {\n                const formData = new FormData();\n                Array.from(files).forEach((file)=>formData.append('images', file));\n                const response = await fetch('http://localhost:5000/api/add-image', {\n                    method: 'POST',\n                    body: formData\n                });\n                if (!response.ok) {\n                    throw new Error('Erreur lors du téléchargement des images');\n                }\n                const data = await response.json();\n                const newHTML = document.documentElement.outerHTML;\n                window.parent.postMessage({\n                    type: 'update-html',\n                    html: newHTML\n                }, '*');\n            } catch (error) {\n                console.error('Erreur:', error);\n                alert('Erreur lors du téléchargement des images');\n            }\n        };\n        input.click();\n    };\n    // Clean HTML code\n    const cleanCode = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)({\n        \"LivePreview.useCallback[cleanCode]\": (htmlCode, pageName)=>{\n            try {\n                let cleaned = htmlCode.replace(/^[\\s\\S]*?(<!DOCTYPE html[\\s\\S]*?<\\/html>)/i, '$1').replace(/```html\\n|```/g, '').replace(/<!--[\\s\\S]*?-->/g, '').trim();\n                if (!cleaned) throw new Error('HTML content is empty after cleaning');\n                if (!cleaned.startsWith('<!DOCTYPE html>')) cleaned = '<!DOCTYPE html>\\n' + cleaned;\n                if (!cleaned.includes('<html')) cleaned = '<!DOCTYPE html>\\n<html lang=\"en\">\\n' + cleaned + '\\n</html>';\n                if (!cleaned.includes('<head>')) {\n                    cleaned = cleaned.replace('<html', '<html lang=\"en\">\\n<head>\\n<meta charset=\"UTF-8\">\\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\\n</head>\\n');\n                }\n                if (!cleaned.includes('<body>')) {\n                    cleaned = cleaned.replace('</head>', '</head>\\n<body>\\n') + '\\n</body>';\n                }\n                if (!cleaned.endsWith('</html>')) cleaned = cleaned + '\\n</html>';\n                return cleaned;\n            } catch (err) {\n                console.error('Error in cleanCode:', err);\n                return lastValidHTML || '\\n        <!DOCTYPE html>\\n        <html lang=\"en\">\\n          <head>\\n            <meta charset=\"UTF-8\">\\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\\n          </head>\\n          <body>\\n            <h1>Erreur : Contenu HTML invalide</h1>\\n          </body>\\n        </html>\\n      ';\n            }\n        }\n    }[\"LivePreview.useCallback[cleanCode]\"], [\n        currentPage,\n        lastValidHTML\n    ]);\n    // Inject drag-and-drop, text editing, and control frame script\n    const injectDragDropScript = ()=>\"\\n    <script>\\n      document.addEventListener('DOMContentLoaded', () => {\\n        const editableElements = document.querySelectorAll('p, h1, h2, h3, h4, h5, h6, span, div, section, article, aside, figure, img, button');\\n        let elementCounter = editableElements.length;\\n\\n        editableElements.forEach((el, index) => {\\n          const isGoogleMapSection = el.tagName === 'SECTION' && el.querySelector('#map');\\n          if ((el.textContent && el.textContent.trim()) || el.tagName === 'IMG' || el.tagName === 'BUTTON' || isGoogleMapSection) {\\n            el.setAttribute('draggable', 'true');\\n            el.setAttribute('data-drag-id', 'drag-' + index);\\n            el.style.position = 'relative';\\n            el.style.cursor = 'move';\\n            el.style.display = isGoogleMapSection ? 'block' : (el.tagName === 'IMG' ? 'inline-block' : el.style.display || 'block');\\n            if (isGoogleMapSection) {\\n              const mapDiv = el.querySelector('#map');\\n              if (mapDiv) {\\n                mapDiv.style.width = mapDiv.style.width || '100%';\\n                mapDiv.style.height = mapDiv.style.height || '400px';\\n              }\\n            }\\n\\n            // Add click handler to show selection frame and toolbar\\n            el.addEventListener('click', (e) => {\\n              e.preventDefault();\\n              e.stopPropagation();\\n\\n              // Remove existing frame and toolbar\\n              const existingFrame = document.querySelector('.selection-frame');\\n              if (existingFrame) existingFrame.remove();\\n              const existingToolbar = document.querySelector('.control-toolbar');\\n              if (existingToolbar) existingToolbar.remove();\\n\\n              // Create selection frame\\n              const rect = el.getBoundingClientRect();\\n              const frame = document.createElement('div');\\n              frame.className = 'selection-frame';\\n              frame.style.position = 'absolute';\\n              frame.style.top = (rect.top - 2 + window.scrollY) + 'px';\\n              frame.style.left = (rect.left - 2 + window.scrollX) + 'px';\\n              frame.style.width = (rect.width + 4) + 'px';\\n              frame.style.height = (rect.height + 4) + 'px';\\n              frame.style.border = '2px solid #007bff';\\n              frame.style.zIndex = '999';\\n              frame.setAttribute('data-target-id', 'drag-' + index);\\n              document.body.appendChild(frame);\\n\\n              // Create toolbar\\n              const toolbar = document.createElement('div');\\n              toolbar.className = 'control-toolbar';\\n              toolbar.style.position = 'absolute';\\n              toolbar.style.top = (rect.top - 40 + window.scrollY) + 'px';\\n              toolbar.style.left = (rect.left + rect.width / 2 - 100 + window.scrollX) + 'px';\\n              toolbar.style.background = '#fff';\\n              toolbar.style.border = '1px solid #ddd';\\n              toolbar.style.borderRadius = '8px';\\n              toolbar.style.padding = '4px';\\n              toolbar.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';\\n              toolbar.style.zIndex = '1000';\\n              toolbar.style.display = 'flex';\\n              toolbar.style.gap = '4px';\\n\\n              const icons = [\\n                { title: 'Edit', icon: '✏️' },\\n                { title: 'Lock', icon: '\\uD83D\\uDD12' },\\n                { title: 'Duplicate', icon: '\\uD83D\\uDCCB' },\\n                { title: 'Delete', icon: '\\uD83D\\uDDD1️' },\\n                { title: 'More', icon: '⋯' },\\n                { title: 'Add Image', icon: '\\uD83D\\uDDBC️' }\\n              ].map(item => {\\n                const btn = document.createElement('button');\\n                btn.innerHTML = item.icon;\\n                btn.title = item.title;\\n                btn.style.border = 'none';\\n                btn.style.background = 'none';\\n                btn.style.cursor = 'pointer';\\n                btn.style.fontSize = '16px';\\n                btn.style.padding = '4px';\\n                btn.addEventListener('click', (e) => {\\n                  e.stopPropagation();\\n                  if (item.title === 'Delete') {\\n                    el.remove();\\n                    frame.remove();\\n                    toolbar.remove();\\n                  } else if (item.title === 'Duplicate') {\\n                    const clone = el.cloneNode(true);\\n                    elementCounter++;\\n                    clone.setAttribute('data-drag-id', 'drag-' + elementCounter);\\n                    el.parentNode.insertBefore(clone, el.nextSibling);\\n                    frame.remove();\\n                    toolbar.remove();\\n                  } else if (item.title === 'Add Image') {\\n                    window.parent.postMessage({ type: 'upload-image' }, '*');\\n                  }\\n                  const newHTML = document.documentElement.outerHTML;\\n                  window.parent.postMessage({ type: 'update-html', html: newHTML }, '*');\\n                });\\n                return btn;\\n              });\\n\\n              icons.forEach(btn => toolbar.appendChild(btn));\\n              document.body.appendChild(toolbar);\\n\\n              // Hide frame and toolbar when clicking outside\\n              document.addEventListener('click', function hideFrame(e) {\\n                if (!frame.contains(e.target) && !el.contains(e.target) && !toolbar.contains(e.target)) {\\n                  frame.remove();\\n                  toolbar.remove();\\n                  document.removeEventListener('click', hideFrame);\\n                }\\n              }, { once: true });\\n            });\\n          }\\n        });\\n\\n        let draggedElement = null;\\n        let dropTarget = null;\\n        let isDragging = false;\\n        let isResizing = false;\\n        let resizeTarget = null;\\n        let startX, startY, startWidth, startHeight;\\n        let resizeEdge = '';\\n\\n        // Drag-and-drop functionality\\n        const handleDragStart = (e) => {\\n          const target = e.target.closest('[draggable=\\\"true\\\"]');\\n          if (target && !isResizing && ((target.textContent && target.textContent.trim()) || target.tagName === 'IMG' || target.tagName === 'BUTTON' || (target.tagName === 'SECTION' && target.querySelector('#map')))) {\\n            draggedElement = target;\\n            isDragging = true;\\n            target.classList.add('dragging');\\n            e.dataTransfer.effectAllowed = 'move';\\n            const existingFrame = document.querySelector('.selection-frame');\\n            if (existingFrame) existingFrame.remove();\\n            const existingToolbar = document.querySelector('.control-toolbar');\\n            if (existingToolbar) existingToolbar.remove();\\n          }\\n        };\\n\\n        const handleDragOver = (e) => {\\n          e.preventDefault();\\n          const target = e.target.closest('[draggable=\\\"true\\\"]');\\n          if (draggedElement && target !== draggedElement && ((target.textContent && target.textContent.trim()) || target.tagName === 'IMG' || target.tagName === 'BUTTON' || (target.tagName === 'SECTION' && target.querySelector('#map')))) {\\n            dropTarget = target;\\n            target.classList.add('drag-over');\\n          }\\n        };\\n\\n        const handleDragLeave = (e) => {\\n          const target = e.target.closest('[draggable=\\\"true\\\"]');\\n          if (target) {\\n            target.classList.remove('drag-over');\\n            dropTarget = null;\\n          }\\n        };\\n\\n        const handleDrop = (e) => {\\n          e.preventDefault();\\n          const target = dropTarget;\\n          if (draggedElement && target && draggedElement !== target && ((draggedElement.textContent && draggedElement.textContent.trim()) || draggedElement.tagName === 'IMG' || draggedElement.tagName === 'BUTTON' || (draggedElement.tagName === 'SECTION' && draggedElement.querySelector('#map')))) {\\n            const parent = target.parentElement;\\n            if (parent) {\\n              const isImageDrag = draggedElement.tagName === 'IMG';\\n              const isImageTarget = target.tagName === 'IMG';\\n              const isButtonDrag = draggedElement.tagName === 'BUTTON';\\n              const isButtonTarget = target.tagName === 'BUTTON';\\n              const isGoogleMapSectionDrag = draggedElement.tagName === 'SECTION' && draggedElement.querySelector('#map');\\n              const isGoogleMapSectionTarget = target.tagName === 'SECTION' && target.querySelector('#map');\\n\\n              if ((isImageDrag && isImageTarget) || (isButtonDrag && isButtonTarget) || (isGoogleMapSectionDrag && isGoogleMapSectionTarget)) {\\n                const tempHTML = draggedElement.innerHTML;\\n                const tempWidth = draggedElement.style.width;\\n                const tempHeight = draggedElement.style.height;\\n                draggedElement.innerHTML = target.innerHTML;\\n                draggedElement.style.width = target.style.width;\\n                draggedElement.style.height = target.style.height;\\n                target.innerHTML = tempHTML;\\n                target.style.width = tempWidth;\\n                target.style.height = tempHeight;\\n\\n                if (isGoogleMapSectionDrag || isGoogleMapSectionTarget) {\\n                  [draggedElement, target].forEach(section => {\\n                    const mapDiv = section.querySelector('#map');\\n                    if (mapDiv) {\\n                      const script = section.querySelector('script:not([src])');\\n                      if (script) eval(script.textContent);\\n                    }\\n                  });\\n                }\\n              } else {\\n                parent.insertBefore(draggedElement, target);\\n              }\\n              draggedElement.classList.remove('dragging');\\n              target.classList.remove('drag-over');\\n              draggedElement = null;\\n              dropTarget = null;\\n\\n              const newHTML = document.documentElement.outerHTML;\\n              window.parent.postMessage({ type: 'update-html', html: newHTML }, '*');\\n            }\\n          }\\n        };\\n\\n        const handleDragEnd = () => {\\n          if (draggedElement) {\\n            draggedElement.classList.remove('dragging');\\n            draggedElement = null;\\n          }\\n          if (dropTarget) {\\n            dropTarget.classList.remove('drag-over');\\n            dropTarget = null;\\n          }\\n          isDragging = false;\\n        };\\n\\n        // Attach drag-and-drop event listeners\\n        document.addEventListener('dragstart', handleDragStart);\\n        document.addEventListener('dragover', handleDragOver);\\n        document.addEventListener('dragleave', handleDragLeave);\\n        document.addEventListener('drop', handleDrop);\\n        document.addEventListener('dragend', handleDragEnd);\\n\\n        // Text editing for all text-containing elements\\n        const textElements = document.querySelectorAll('p, h1, h2, h3, h4, h5, h6, span, button');\\n        textElements.forEach(el => {\\n          if (el.textContent && el.textContent.trim()) {\\n            el.style.overflowWrap = el.style.overflowWrap || 'break-word';\\n            el.style.wordBreak = el.style.wordBreak || 'break-word';\\n            el.style.whiteSpace = el.style.whiteSpace || 'normal';\\n\\n            el.addEventListener('click', (e) => {\\n              if (el.classList.contains('editing')) return;\\n              el.classList.add('editing');\\n\\n              const computedStyle = window.getComputedStyle(el);\\n              const originalText = el.textContent;\\n\\n              const textarea = document.createElement('textarea');\\n              textarea.value = originalText;\\n\\n              textarea.style.width = computedStyle.width;\\n              textarea.style.maxWidth = computedStyle.maxWidth === 'none' ? computedStyle.width : computedStyle.maxWidth;\\n              textarea.style.height = 'auto';\\n              textarea.style.minHeight = computedStyle.height;\\n              textarea.style.maxHeight = computedStyle.maxHeight === 'none' ? 'none' : computedStyle.maxHeight;\\n              textarea.style.padding = computedStyle.padding;\\n              textarea.style.margin = computedStyle.margin;\\n              textarea.style.border = '1px solid #ccc';\\n              textarea.style.borderRadius = computedStyle.borderRadius;\\n              textarea.style.fontFamily = computedStyle.fontFamily;\\n              textarea.style.fontSize = computedStyle.fontSize;\\n              textarea.style.fontWeight = computedStyle.fontWeight;\\n              textarea.style.color = computedStyle.color;\\n              textarea.style.backgroundColor = computedStyle.backgroundColor;\\n              textarea.style.lineHeight = computedStyle.lineHeight;\\n              textarea.style.textAlign = computedStyle.textAlign;\\n              textarea.style.boxSizing = 'border-box';\\n              textarea.style.resize = 'vertical';\\n              textarea.style.overflowWrap = 'break-word';\\n              textarea.style.wordBreak = 'break-word';\\n              textarea.style.whiteSpace = 'normal';\\n              textarea.style.overflow = computedStyle.overflow === 'visible' ? 'auto' : computedStyle.overflow;\\n\\n              el.textContent = '';\\n              el.appendChild(textarea);\\n              textarea.focus();\\n\\n              textarea.style.height = 'auto';\\n              textarea.style.height = `${textarea.scrollHeight}px`;\\n\\n              textarea.addEventListener('input', () => {\\n                textarea.style.height = 'auto';\\n                textarea.style.height = `${textarea.scrollHeight}px`;\\n              });\\n\\n              textarea.addEventListener('blur', () => {\\n                const newText = textarea.value || originalText;\\n                while (el.firstChild) {\\n                  el.removeChild(el.firstChild);\\n                }\\n                el.textContent = newText;\\n                el.classList.remove('editing');\\n\\n                el.style.overflowWrap = 'break-word';\\n                el.style.wordBreak = 'break-word';\\n                el.style.whiteSpace = 'normal';\\n\\n                const newHTML = document.documentElement.outerHTML;\\n                window.parent.postMessage({ type: 'update-html', html: newHTML }, '*');\\n              });\\n\\n              textarea.addEventListener('keypress', (e) => {\\n                if (e.key === 'Enter' && !e.shiftKey) {\\n                  e.preventDefault();\\n                  textarea.blur();\\n                }\\n              });\\n            });\\n          }\\n        });\\n\\n        // Helper function to determine if the mouse is near an edge\\n        const isNearEdge = (el, clientX, clientY) => {\\n          const rect = el.getBoundingClientRect();\\n          const edgeThreshold = 10;\\n          const nearRight = Math.abs(clientX - rect.right) < edgeThreshold;\\n          const nearBottom = Math.abs(clientY - rect.bottom) < edgeThreshold;\\n          const nearLeft = Math.abs(clientX - rect.left) < edgeThreshold;\\n          const nearTop = Math.abs(clientY - rect.top) < edgeThreshold;\\n\\n          if (nearRight && nearBottom) return 'bottom-right';\\n          if (nearLeft && nearBottom) return 'bottom-left';\\n          if (nearRight && nearTop) return 'top-right';\\n          if (nearLeft && nearTop) return 'top-left';\\n          if (nearRight) return 'right';\\n          if (nearLeft) return 'left';\\n          if (nearBottom) return 'bottom';\\n          if (nearTop) return 'top';\\n          return '';\\n        };\\n\\n        // Edge-based resizing on the selection frame\\n        document.addEventListener('mousemove', (e) => {\\n          if (isResizing) return;\\n\\n          const frame = document.querySelector('.selection-frame');\\n          if (frame) {\\n            const edge = isNearEdge(frame, e.clientX, e.clientY);\\n            if (edge === 'bottom-right' || edge === 'top-left') {\\n              frame.style.cursor = 'se-resize';\\n            } else if (edge === 'bottom-left' || edge === 'top-right') {\\n              frame.style.cursor = 'sw-resize';\\n            } else if (edge === 'left' || edge === 'right') {\\n              frame.style.cursor = 'ew-resize';\\n            } else if (edge === 'top' || edge === 'bottom') {\\n              frame.style.cursor = 'ns-resize';\\n            } else {\\n              frame.style.cursor = 'default';\\n            }\\n          }\\n        });\\n\\n        document.addEventListener('mousedown', (e) => {\\n          const frame = document.querySelector('.selection-frame');\\n          const target = document.querySelector('[data-drag-id=\\\"' + (frame?.getAttribute('data-target-id') || '') + '\\\"]');\\n          if (frame && target) {\\n            const edge = isNearEdge(frame, e.clientX, e.clientY);\\n            if (edge) {\\n              isResizing = true;\\n              resizeTarget = target;\\n              resizeEdge = edge;\\n              startX = e.clientX;\\n              startY = e.clientY;\\n              startWidth = parseInt(getComputedStyle(target).width) || target.offsetWidth;\\n              startHeight = parseInt(getComputedStyle(target).height) || target.offsetHeight;\\n              e.preventDefault();\\n            }\\n          }\\n        });\\n\\n        document.addEventListener('mousemove', (e) => {\\n          if (!isResizing || !resizeTarget) return;\\n\\n          const dx = e.clientX - startX;\\n          const dy = e.clientY - startY;\\n          let newWidth = startWidth;\\n          let newHeight = startHeight;\\n\\n          if (resizeEdge.includes('right')) {\\n            newWidth = Math.max(50, startWidth + dx);\\n          } else if (resizeEdge.includes('left')) {\\n            newWidth = Math.max(50, startWidth - dx);\\n            resizeTarget.style.left = (parseInt(getComputedStyle(resizeTarget).left) || 0) + (startWidth - newWidth) + 'px';\\n          }\\n          if (resizeEdge.includes('bottom')) {\\n            newHeight = Math.max(50, startHeight + dy);\\n          } else if (resizeEdge.includes('top')) {\\n            newHeight = Math.max(50, startHeight - dy);\\n            resizeTarget.style.top = (parseInt(getComputedStyle(resizeTarget).top) || 0) + (startHeight - newHeight) + 'px';\\n          }\\n\\n          resizeTarget.style.width = `${newWidth}px`;\\n          resizeTarget.style.height = `${newHeight}px`;\\n\\n          const mapDiv = resizeTarget.querySelector('#map');\\n          if (mapDiv) {\\n            mapDiv.style.width = `${newWidth}px`;\\n            mapDiv.style.height = `${newHeight - 50}px`;\\n            if (typeof google !== 'undefined' && google.maps) {\\n              google.maps.event.trigger(mapDiv.__gmap__, 'resize');\\n            }\\n          }\\n\\n          // Update the frame size\\n          const frame = document.querySelector('.selection-frame');\\n          if (frame) {\\n            frame.style.width = (newWidth + 4) + 'px';\\n            frame.style.height = (newHeight + 4) + 'px';\\n            frame.style.left = (resizeTarget.getBoundingClientRect().left - 2 + window.scrollX) + 'px';\\n            frame.style.top = (resizeTarget.getBoundingClientRect().top - 2 + window.scrollY) + 'px';\\n          }\\n        });\\n\\n        document.addEventListener('mouseup', () => {\\n          if (isResizing) {\\n            isResizing = false;\\n            const newHTML = document.documentElement.outerHTML;\\n            window.parent.postMessage({ type: 'update-html', html: newHTML }, '*');\\n            resizeTarget.style.cursor = 'move';\\n            resizeTarget = null;\\n            resizeEdge = '';\\n          }\\n        });\\n      });\\n    </script>\\n    <style>\\n      .dragging {\\n        opacity: 0.5;\\n        transform: scale(1.2);\\n        transition: opacity 0.3s, transform 0.2s ease-in-out;\\n        border: 2px dashed #007bff;\\n      }\\n      .drag-over {\\n        background: #a5d6a7;\\n        border: 2px dashed #4caf50;\\n      }\\n      [draggable=\\\"true\\\"] {\\n        padding: 0.5rem;\\n        margin: 0.5rem;\\n        cursor: grab;\\n      }\\n      [draggable=\\\"true\\\"].dragging {\\n        cursor: grabbing;\\n      }\\n      .editing {\\n        border: 1px dashed #007bff;\\n        padding: 5px;\\n      }\\n      img, div, section, article, aside, figure, button {\\n        min-width: 50px;\\n        min-height: 50px;\\n      }\\n      section:has(#map) {\\n        border: 1px solid #ddd;\\n        border-radius: 8px;\\n        padding: 10px;\\n        box-shadow: 0 2px 5px rgba(0,0,0,0.1);\\n      }\\n      .control-toolbar button:hover {\\n        background: #f0f0f0;\\n        border-radius: 4px;\\n      }\\n      .selection-frame {\\n        pointer-events: auto;\\n        box-sizing: border-box;\\n      }\\n    </style>\\n  \";\n    // Process HTML with navigation and drag-and-drop scripts\n    const processHTML = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)({\n        \"LivePreview.useCallback[processHTML]\": (html, pageList)=>{\n            try {\n                const parser = new DOMParser();\n                const doc = parser.parseFromString(html, 'text/html');\n                if (!doc.querySelector('script[data-navigation-handler]')) {\n                    const script = doc.createElement('script');\n                    script.setAttribute('data-navigation-handler', 'true');\n                    script.textContent = \"\\n          document.addEventListener('DOMContentLoaded', () => {\\n            document.querySelectorAll('a[href$=\\\".html\\\"]').forEach(link => {\\n              link.addEventListener('click', e => {\\n                e.preventDefault();\\n                const href = link.getAttribute('href');\\n                window.parent.postMessage({ type: 'navigation', href }, '*');\\n              });\\n            });\\n          });\\n        \";\n                    doc.body.appendChild(script);\n                }\n                if (!doc.querySelector('script[data-drag-drop-handler]')) {\n                    const dragDropScript = doc.createElement('script');\n                    dragDropScript.setAttribute('data-drag-drop-handler', 'true');\n                    dragDropScript.textContent = injectDragDropScript();\n                    doc.body.appendChild(dragDropScript);\n                }\n                const nav = doc.querySelector('nav');\n                if (nav && pageList.length > 0) {\n                    const theme = nav.getAttribute('data-theme') || 'digital';\n                    nav.outerHTML = getNavBar(pageList, currentPage, theme);\n                }\n                return '<!DOCTYPE html>' + doc.documentElement.outerHTML;\n            } catch (err) {\n                console.error('Error processing HTML:', err);\n                throw new Error('Invalid HTML content');\n            }\n        }\n    }[\"LivePreview.useCallback[processHTML]\"], [\n        currentPage\n    ]);\n    // Navigation bar generator\n    function getNavBar(pages, currentPage, theme) {\n        const colors = {\n            navBg: 'rgba(42, 42, 42, 0.8)',\n            navLink: '#e0e0e0',\n            navActive: '#bb86fc'\n        };\n        return '\\n      <nav style=\"position: sticky; top: 0; background: '.concat(colors.navBg, '; padding: 1rem 2rem; text-align: center; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); z-index: 1000;\">\\n        ').concat(pages.map((page)=>{\n            const pageName = page.replace('.html', '');\n            const isActive = page === currentPage;\n            const activeStyle = isActive ? \"color: \".concat(colors.navActive, \"; border-bottom: 2px solid \").concat(colors.navActive, \";\") : '';\n            return '<a href=\"'.concat(page, '\" style=\"color: ').concat(colors.navLink, \"; text-decoration: none; margin: 0 1.5rem; font-weight: 600; \").concat(activeStyle, '\">').concat(pageName, \"</a>\");\n        }).join(''), \"\\n      </nav>\\n    \");\n    }\n    // Handle drag-and-drop events for file uploads\n    const handleDragOver = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)({\n        \"LivePreview.useCallback[handleDragOver]\": (e)=>{\n            e.preventDefault();\n            e.stopPropagation();\n            setIsDragOver(true);\n        }\n    }[\"LivePreview.useCallback[handleDragOver]\"], []);\n    const handleDragLeave = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)({\n        \"LivePreview.useCallback[handleDragLeave]\": (e)=>{\n            e.preventDefault();\n            e.stopPropagation();\n            setIsDragOver(false);\n        }\n    }[\"LivePreview.useCallback[handleDragLeave]\"], []);\n    const handleDrop = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)({\n        \"LivePreview.useCallback[handleDrop]\": async (e)=>{\n            e.preventDefault();\n            e.stopPropagation();\n            setIsDragOver(false);\n            const files = e.dataTransfer.files;\n            if (files.length > 0) {\n                const file = files[0];\n                const reader = new FileReader();\n                reader.onload = ({\n                    \"LivePreview.useCallback[handleDrop]\": (event)=>{\n                        if (event.target && typeof event.target.result === 'string') {\n                            if (onFileUpload) onFileUpload(file, event.target.result);\n                        }\n                    }\n                })[\"LivePreview.useCallback[handleDrop]\"];\n                reader.readAsText(file);\n            }\n        }\n    }[\"LivePreview.useCallback[handleDrop]\"], [\n        onFileUpload\n    ]);\n    // Update iframe content with debouncing\n    const updateIframe = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)({\n        \"LivePreview.useMemo[updateIframe]\": ()=>lodash_debounce__WEBPACK_IMPORTED_MODULE_2___default()({\n                \"LivePreview.useMemo[updateIframe]\": ()=>{\n                    const iframe = iframeRef.current;\n                    if (!iframe || !pages[currentPage]) {\n                        setError('Page not found or iframe unavailable');\n                        setIsLoading(false);\n                        if (iframe && lastValidHTML) iframe.srcdoc = lastValidHTML;\n                        return;\n                    }\n                    setIsLoading(true);\n                    setError(null);\n                    try {\n                        const cleanedHTML = cleanCode(pages[currentPage], currentPage);\n                        const pageList = Object.keys(pages);\n                        const processedHTML = processHTML(cleanedHTML + injectDragDropScript(), pageList);\n                        iframe.srcdoc = processedHTML;\n                        setLastValidHTML(processedHTML);\n                    } catch (err) {\n                        setError('Failed to load page content: ' + (err instanceof Error ? err.message : String(err)));\n                        setIsLoading(false);\n                        if (iframe && lastValidHTML) iframe.srcdoc = lastValidHTML;\n                    }\n                }\n            }[\"LivePreview.useMemo[updateIframe]\"], 300)\n    }[\"LivePreview.useMemo[updateIframe]\"], [\n        currentPage,\n        pages,\n        processHTML,\n        cleanCode,\n        lastValidHTML\n    ]);\n    // Handle iframe updates and messages\n    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)({\n        \"LivePreview.useEffect\": ()=>{\n            updateIframe();\n            const iframe = iframeRef.current;\n            if (!iframe) return;\n            const handleLoad = {\n                \"LivePreview.useEffect.handleLoad\": ()=>setIsLoading(false)\n            }[\"LivePreview.useEffect.handleLoad\"];\n            iframe.addEventListener('load', handleLoad);\n            const handleMessage = {\n                \"LivePreview.useEffect.handleMessage\": async (event)=>{\n                    var _event_data, _event_data1, _event_data2;\n                    if (event.origin !== 'http://localhost:3000') return; // Security check\n                    if (((_event_data = event.data) === null || _event_data === void 0 ? void 0 : _event_data.type) === 'navigation' && typeof event.data.href === 'string') {\n                        if (pages[event.data.href]) {\n                            setLocalPage(event.data.href);\n                            onPageChange === null || onPageChange === void 0 ? void 0 : onPageChange(event.data.href);\n                        } else {\n                            setError('Page \"'.concat(event.data.href, '\" not found'));\n                            const fallbackPage = Object.keys(pages).filter({\n                                \"LivePreview.useEffect.handleMessage\": (page)=>page.endsWith('.html')\n                            }[\"LivePreview.useEffect.handleMessage\"])[0] || '';\n                            setLocalPage(fallbackPage);\n                            onPageChange === null || onPageChange === void 0 ? void 0 : onPageChange(fallbackPage);\n                        }\n                    } else if (((_event_data1 = event.data) === null || _event_data1 === void 0 ? void 0 : _event_data1.type) === 'file-drop') {\n                        if (onFileUpload) {\n                            const fileContent = event.data.fileContent;\n                            const fileName = event.data.fileName;\n                            if (typeof fileContent === 'string' && typeof fileName === 'string') {\n                                const file = new File([\n                                    fileContent\n                                ], fileName, {\n                                    type: 'text/html'\n                                });\n                                onFileUpload(file, fileContent);\n                            }\n                        }\n                    } else if (((_event_data2 = event.data) === null || _event_data2 === void 0 ? void 0 : _event_data2.type) === 'update-html') {\n                        const newHTML = event.data.html;\n                        try {\n                            const response = await fetch('http://localhost:5000/api/save-page', {\n                                method: 'POST',\n                                headers: {\n                                    'Content-Type': 'application/json'\n                                },\n                                body: JSON.stringify({\n                                    pagePath: currentPage,\n                                    code: newHTML\n                                })\n                            });\n                            if (!response.ok) {\n                                throw new Error(\"HTTP error! status: \".concat(response.status));\n                            }\n                            const result = await response.json();\n                            pages[currentPage] = newHTML; // Update local state\n                            updateIframe(); // Refresh iframe\n                        } catch (err) {\n                            setError(\"Failed to save updated HTML: \".concat(err instanceof Error ? err.message : String(err)));\n                        }\n                    }\n                }\n            }[\"LivePreview.useEffect.handleMessage\"];\n            window.addEventListener('message', handleMessage);\n            return ({\n                \"LivePreview.useEffect\": ()=>{\n                    iframe.removeEventListener('load', handleLoad);\n                    updateIframe.cancel();\n                    window.removeEventListener('message', handleMessage);\n                }\n            })[\"LivePreview.useEffect\"];\n        }\n    }[\"LivePreview.useEffect\"], [\n        currentPage,\n        pages,\n        updateIframe,\n        onFileUpload\n    ]);\n    // Validate initial page\n    (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)({\n        \"LivePreview.useEffect\": ()=>{\n            if (!pages[currentPage]) {\n                setError('Page \"'.concat(currentPage, '\" not found'));\n                const firstPage = Object.keys(pages).filter({\n                    \"LivePreview.useEffect\": (page)=>page.endsWith('.html')\n                }[\"LivePreview.useEffect\"])[0] || '';\n                if (!localPage && firstPage) {\n                    setLocalPage(firstPage);\n                    onPageChange === null || onPageChange === void 0 ? void 0 : onPageChange(firstPage);\n                }\n            } else if (!localPage) {\n                setLocalPage(currentPage);\n            }\n        }\n    }[\"LivePreview.useEffect\"], [\n        currentPage,\n        pages\n    ]);\n    return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n        ref: dropZoneRef,\n        onDragOver: handleDragOver,\n        onDragLeave: handleDragLeave,\n        onDrop: handleDrop,\n        className: \"relative h-full w-full rounded-lg border border-gray-200 bg-white shadow-sm overflow-hidden transition-all duration-300 \".concat(isDragOver ? 'border-purple-500 border-4' : ''),\n        children: [\n            isDragOver && /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n                className: \"absolute inset-0 bg-purple-500 bg-opacity-50 z-50 flex items-center justify-center\",\n                children: /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n                    className: \"text-white text-2xl font-bold\",\n                    children: \"Drop your file here\"\n                }, void 0, false, {\n                    fileName: \"C:\\\\Users\\\\Abir\\\\Desktop\\\\lasttrynchlh - Copy (8)\\\\deepsite\\\\frontend\\\\src\\\\components\\\\LivePreview.tsx\",\n                    lineNumber: 768,\n                    columnNumber: 11\n                }, undefined)\n            }, void 0, false, {\n                fileName: \"C:\\\\Users\\\\Abir\\\\Desktop\\\\lasttrynchlh - Copy (8)\\\\deepsite\\\\frontend\\\\src\\\\components\\\\LivePreview.tsx\",\n                lineNumber: 767,\n                columnNumber: 9\n            }, undefined),\n            isLoading && /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n                className: \"absolute inset-0 flex items-center justify-center bg-white/80 z-10 transition-opacity duration-200\",\n                children: /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n                    className: \"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-purple-600\"\n                }, void 0, false, {\n                    fileName: \"C:\\\\Users\\\\Abir\\\\Desktop\\\\lasttrynchlh - Copy (8)\\\\deepsite\\\\frontend\\\\src\\\\components\\\\LivePreview.tsx\",\n                    lineNumber: 773,\n                    columnNumber: 11\n                }, undefined)\n            }, void 0, false, {\n                fileName: \"C:\\\\Users\\\\Abir\\\\Desktop\\\\lasttrynchlh - Copy (8)\\\\deepsite\\\\frontend\\\\src\\\\components\\\\LivePreview.tsx\",\n                lineNumber: 772,\n                columnNumber: 9\n            }, undefined),\n            error && /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n                className: \"absolute inset-0 flex items-center justify-center bg-red-50 z-10 p-4\",\n                children: /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"p\", {\n                    className: \"text-red-600 font-medium text-sm\",\n                    children: error\n                }, void 0, false, {\n                    fileName: \"C:\\\\Users\\\\Abir\\\\Desktop\\\\lasttrynchlh - Copy (8)\\\\deepsite\\\\frontend\\\\src\\\\components\\\\LivePreview.tsx\",\n                    lineNumber: 778,\n                    columnNumber: 11\n                }, undefined)\n            }, void 0, false, {\n                fileName: \"C:\\\\Users\\\\Abir\\\\Desktop\\\\lasttrynchlh - Copy (8)\\\\deepsite\\\\frontend\\\\src\\\\components\\\\LivePreview.tsx\",\n                lineNumber: 777,\n                columnNumber: 9\n            }, undefined),\n            /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"iframe\", {\n                ref: iframeRef,\n                title: \"Live Preview\",\n                className: \"w-full h-full bg-white\",\n                sandbox: \"allow-scripts allow-same-origin allow-popups\",\n                onError: ()=>setError('Failed to load iframe content')\n            }, void 0, false, {\n                fileName: \"C:\\\\Users\\\\Abir\\\\Desktop\\\\lasttrynchlh - Copy (8)\\\\deepsite\\\\frontend\\\\src\\\\components\\\\LivePreview.tsx\",\n                lineNumber: 781,\n                columnNumber: 7\n            }, undefined)\n        ]\n    }, void 0, true, {\n        fileName: \"C:\\\\Users\\\\Abir\\\\Desktop\\\\lasttrynchlh - Copy (8)\\\\deepsite\\\\frontend\\\\src\\\\components\\\\LivePreview.tsx\",\n        lineNumber: 759,\n        columnNumber: 5\n    }, undefined);\n};\n_s(LivePreview, \"K20nyLPwtUiJqcesPnOkE1Tcfbo=\");\n_c = LivePreview;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (LivePreview);\nvar _c;\n$RefreshReg$(_c, \"LivePreview\");\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL3NyYy9jb21wb25lbnRzL0xpdmVQcmV2aWV3LnRzeCIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUNpRjtBQUMvQztBQVNsQyxNQUFNTyxjQUEwQztRQUFDLEVBQUVDLEtBQUssRUFBRUMsV0FBVyxFQUFFQyxZQUFZLEVBQUVDLFlBQVksRUFBRTs7SUFDakcsTUFBTSxDQUFDQyxXQUFXQyxhQUFhLEdBQUdWLCtDQUFRQSxDQUFTTTtJQUNuRCxNQUFNLENBQUNLLFdBQVdDLGFBQWEsR0FBR1osK0NBQVFBLENBQVU7SUFDcEQsTUFBTSxDQUFDYSxZQUFZQyxjQUFjLEdBQUdkLCtDQUFRQSxDQUFVO0lBQ3RELE1BQU0sQ0FBQ2UsT0FBT0MsU0FBUyxHQUFHaEIsK0NBQVFBLENBQWdCO0lBQ2xELE1BQU0sQ0FBQ2lCLGVBQWVDLGlCQUFpQixHQUFHbEIsK0NBQVFBLENBQWdCO0lBQ2xFLE1BQU1tQixZQUFZcEIsNkNBQU1BLENBQW9CO0lBQzVDLE1BQU1xQixjQUFjckIsNkNBQU1BLENBQWlCO0lBRTNDLHFCQUFxQjtJQUNyQixNQUFNc0Isb0JBQW9CO1FBQ3hCLE1BQU1DLFFBQVFDLFNBQVNDLGFBQWEsQ0FBQztRQUNyQ0YsTUFBTUcsSUFBSSxHQUFHO1FBQ2JILE1BQU1JLE1BQU0sR0FBRztRQUNmSixNQUFNSyxRQUFRLEdBQUc7UUFFakJMLE1BQU1NLFFBQVEsR0FBRyxPQUFPQztZQUN0QixNQUFNQyxRQUFRLE1BQU9DLE1BQU0sQ0FBc0JELEtBQUs7WUFDdEQsSUFBSSxDQUFDQSxTQUFTQSxNQUFNRSxNQUFNLEtBQUssR0FBRztZQUVsQyxJQUFJO2dCQUNGLE1BQU1DLFdBQVcsSUFBSUM7Z0JBQ3JCQyxNQUFNQyxJQUFJLENBQUNOLE9BQU9PLE9BQU8sQ0FBQ0MsQ0FBQUEsT0FBUUwsU0FBU00sTUFBTSxDQUFDLFVBQVVEO2dCQUU1RCxNQUFNRSxXQUFXLE1BQU1DLE1BQU0sdUNBQXVDO29CQUNsRUMsUUFBUTtvQkFDUkMs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LFNBQVMsSUFBTWhJLFNBQVM7Ozs7Ozs7Ozs7OztBQUloQztHQTF3Qk1aO0tBQUFBO0FBNHdCTixpRUFBZUEsV0FBV0EsRUFBQyIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBYmlyXFxEZXNrdG9wXFxsYXN0dHJ5bmNobGggLSBDb3B5ICg4KVxcZGVlcHNpdGVcXGZyb250ZW5kXFxzcmNcXGNvbXBvbmVudHNcXExpdmVQcmV2aWV3LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGNsaWVudCc7XG5pbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VSZWYsIHVzZVN0YXRlLCB1c2VDYWxsYmFjaywgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGRlYm91bmNlIH0gZnJvbSAnbG9kYXNoJztcblxuaW50ZXJmYWNlIExpdmVQcmV2aWV3UHJvcHMge1xuICBwYWdlczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfTtcbiAgY3VycmVudFBhZ2U6IHN0cmluZztcbiAgb25GaWxlVXBsb2FkPzogKGZpbGU6IEZpbGUsIGNvbnRlbnQ6IHN0cmluZykgPT4gdm9pZDtcbiAgb25QYWdlQ2hhbmdlPzogKHBhZ2U6IHN0cmluZykgPT4gdm9pZDtcbn1cblxuY29uc3QgTGl2ZVByZXZpZXc6IFJlYWN0LkZDPExpdmVQcmV2aWV3UHJvcHM+ID0gKHsgcGFnZXMsIGN1cnJlbnRQYWdlLCBvblBhZ2VDaGFuZ2UsIG9uRmlsZVVwbG9hZCB9KSA9PiB7XG4gIGNvbnN0IFtsb2NhbFBhZ2UsIHNldExvY2FsUGFnZV0gPSB1c2VTdGF0ZTxzdHJpbmc+KGN1cnJlbnRQYWdlKTtcbiAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlPGJvb2xlYW4+KHRydWUpO1xuICBjb25zdCBbaXNEcmFnT3Zlciwgc2V0SXNEcmFnT3Zlcl0gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSk7XG4gIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbCk7XG4gIGNvbnN0IFtsYXN0VmFsaWRIVE1MLCBzZXRMYXN0VmFsaWRIVE1MXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xuICBjb25zdCBpZnJhbWVSZWYgPSB1c2VSZWY8SFRNTElGcmFtZUVsZW1lbnQ+KG51bGwpO1xuICBjb25zdCBkcm9wWm9uZVJlZiA9IHVzZVJlZjxIVE1MRGl2RWxlbWVudD4obnVsbCk7XG5cbiAgLy8gR2VzdGlvbiBkZXMgaW1hZ2VzXG4gIGNvbnN0IGhhbmRsZUltYWdlVXBsb2FkID0gKCkgPT4ge1xuICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBpbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgIGlucHV0LmFjY2VwdCA9ICdpbWFnZS8qJztcbiAgICBpbnB1dC5tdWx0aXBsZSA9IHRydWU7XG5cbiAgICBpbnB1dC5vbmNoYW5nZSA9IGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgY29uc3QgZmlsZXMgPSAoZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLmZpbGVzO1xuICAgICAgaWYgKCFmaWxlcyB8fCBmaWxlcy5sZW5ndGggPT09IDApIHJldHVybjtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgQXJyYXkuZnJvbShmaWxlcykuZm9yRWFjaChmaWxlID0+IGZvcm1EYXRhLmFwcGVuZCgnaW1hZ2VzJywgZmlsZSkpO1xuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6NTAwMC9hcGkvYWRkLWltYWdlJywge1xuICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgIGJvZHk6IGZvcm1EYXRhLFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJldXIgbG9ycyBkdSB0w6lsw6ljaGFyZ2VtZW50IGRlcyBpbWFnZXMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGNvbnN0IG5ld0hUTUwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub3V0ZXJIVE1MO1xuICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHsgdHlwZTogJ3VwZGF0ZS1odG1sJywgaHRtbDogbmV3SFRNTCB9LCAnKicpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyZXVyOicsIGVycm9yKTtcbiAgICAgICAgYWxlcnQoJ0VycmV1ciBsb3JzIGR1IHTDqWzDqWNoYXJnZW1lbnQgZGVzIGltYWdlcycpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpbnB1dC5jbGljaygpO1xuICB9O1xuXG4gIC8vIENsZWFuIEhUTUwgY29kZVxuICBjb25zdCBjbGVhbkNvZGUgPSB1c2VDYWxsYmFjaygoaHRtbENvZGU6IHN0cmluZywgcGFnZU5hbWU6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBjbGVhbmVkID0gaHRtbENvZGVcbiAgICAgICAgLnJlcGxhY2UoL15bXFxzXFxTXSo/KDwhRE9DVFlQRSBodG1sW1xcc1xcU10qPzxcXC9odG1sPikvaSwgJyQxJylcbiAgICAgICAgLnJlcGxhY2UoL2BgYGh0bWxcXG58YGBgL2csICcnKVxuICAgICAgICAucmVwbGFjZSgvPCEtLVtcXHNcXFNdKj8tLT4vZywgJycpXG4gICAgICAgIC50cmltKCk7XG4gIFxuICAgICAgaWYgKCFjbGVhbmVkKSB0aHJvdyBuZXcgRXJyb3IoJ0hUTUwgY29udGVudCBpcyBlbXB0eSBhZnRlciBjbGVhbmluZycpO1xuICBcbiAgICAgIGlmICghY2xlYW5lZC5zdGFydHNXaXRoKCc8IURPQ1RZUEUgaHRtbD4nKSkgY2xlYW5lZCA9ICc8IURPQ1RZUEUgaHRtbD5cXG4nICsgY2xlYW5lZDtcbiAgICAgIGlmICghY2xlYW5lZC5pbmNsdWRlcygnPGh0bWwnKSkgY2xlYW5lZCA9ICc8IURPQ1RZUEUgaHRtbD5cXG48aHRtbCBsYW5nPVwiZW5cIj5cXG4nICsgY2xlYW5lZCArICdcXG48L2h0bWw+JztcbiAgICAgIGlmICghY2xlYW5lZC5pbmNsdWRlcygnPGhlYWQ+JykpIHtcbiAgICAgICAgY2xlYW5lZCA9IGNsZWFuZWQucmVwbGFjZShcbiAgICAgICAgICAnPGh0bWwnLFxuICAgICAgICAgICc8aHRtbCBsYW5nPVwiZW5cIj5cXG48aGVhZD5cXG48bWV0YSBjaGFyc2V0PVwiVVRGLThcIj5cXG48bWV0YSBuYW1lPVwidmlld3BvcnRcIiBjb250ZW50PVwid2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMFwiPlxcbjwvaGVhZD5cXG4nXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoIWNsZWFuZWQuaW5jbHVkZXMoJzxib2R5PicpKSB7XG4gICAgICAgIGNsZWFuZWQgPSBjbGVhbmVkLnJlcGxhY2UoJzwvaGVhZD4nLCAnPC9oZWFkPlxcbjxib2R5PlxcbicpICsgJ1xcbjwvYm9keT4nO1xuICAgICAgfVxuICBcbiAgICAgIGlmICghY2xlYW5lZC5lbmRzV2l0aCgnPC9odG1sPicpKSBjbGVhbmVkID0gY2xlYW5lZCArICdcXG48L2h0bWw+JztcbiAgXG4gICAgICByZXR1cm4gY2xlYW5lZDtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGNsZWFuQ29kZTonLCBlcnIpO1xuICAgICAgcmV0dXJuIGxhc3RWYWxpZEhUTUwgfHwgYFxuICAgICAgICA8IURPQ1RZUEUgaHRtbD5cbiAgICAgICAgPGh0bWwgbGFuZz1cImVuXCI+XG4gICAgICAgICAgPGhlYWQ+XG4gICAgICAgICAgICA8bWV0YSBjaGFyc2V0PVwiVVRGLThcIj5cbiAgICAgICAgICAgIDxtZXRhIG5hbWU9XCJ2aWV3cG9ydFwiIGNvbnRlbnQ9XCJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wXCI+XG4gICAgICAgICAgPC9oZWFkPlxuICAgICAgICAgIDxib2R5PlxuICAgICAgICAgICAgPGgxPkVycmV1ciA6IENvbnRlbnUgSFRNTCBpbnZhbGlkZTwvaDE+XG4gICAgICAgICAgPC9ib2R5PlxuICAgICAgICA8L2h0bWw+XG4gICAgICBgO1xuICAgIH1cbiAgfSwgW2N1cnJlbnRQYWdlLGxhc3RWYWxpZEhUTUxdKTtcblxuXG5cbiAgLy8gSW5qZWN0IGRyYWctYW5kLWRyb3AsIHRleHQgZWRpdGluZywgYW5kIGNvbnRyb2wgZnJhbWUgc2NyaXB0XG4gIGNvbnN0IGluamVjdERyYWdEcm9wU2NyaXB0ID0gKCkgPT4gYFxuICAgIDxzY3JpcHQ+XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBlZGl0YWJsZUVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgncCwgaDEsIGgyLCBoMywgaDQsIGg1LCBoNiwgc3BhbiwgZGl2LCBzZWN0aW9uLCBhcnRpY2xlLCBhc2lkZSwgZmlndXJlLCBpbWcsIGJ1dHRvbicpO1xuICAgICAgICBsZXQgZWxlbWVudENvdW50ZXIgPSBlZGl0YWJsZUVsZW1lbnRzLmxlbmd0aDtcblxuICAgICAgICBlZGl0YWJsZUVsZW1lbnRzLmZvckVhY2goKGVsLCBpbmRleCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGlzR29vZ2xlTWFwU2VjdGlvbiA9IGVsLnRhZ05hbWUgPT09ICdTRUNUSU9OJyAmJiBlbC5xdWVyeVNlbGVjdG9yKCcjbWFwJyk7XG4gICAgICAgICAgaWYgKChlbC50ZXh0Q29udGVudCAmJiBlbC50ZXh0Q29udGVudC50cmltKCkpIHx8IGVsLnRhZ05hbWUgPT09ICdJTUcnIHx8IGVsLnRhZ05hbWUgPT09ICdCVVRUT04nIHx8IGlzR29vZ2xlTWFwU2VjdGlvbikge1xuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdkcmFnZ2FibGUnLCAndHJ1ZScpO1xuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdkYXRhLWRyYWctaWQnLCAnZHJhZy0nICsgaW5kZXgpO1xuICAgICAgICAgICAgZWwuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xuICAgICAgICAgICAgZWwuc3R5bGUuY3Vyc29yID0gJ21vdmUnO1xuICAgICAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9IGlzR29vZ2xlTWFwU2VjdGlvbiA/ICdibG9jaycgOiAoZWwudGFnTmFtZSA9PT0gJ0lNRycgPyAnaW5saW5lLWJsb2NrJyA6IGVsLnN0eWxlLmRpc3BsYXkgfHwgJ2Jsb2NrJyk7XG4gICAgICAgICAgICBpZiAoaXNHb29nbGVNYXBTZWN0aW9uKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG1hcERpdiA9IGVsLnF1ZXJ5U2VsZWN0b3IoJyNtYXAnKTtcbiAgICAgICAgICAgICAgaWYgKG1hcERpdikge1xuICAgICAgICAgICAgICAgIG1hcERpdi5zdHlsZS53aWR0aCA9IG1hcERpdi5zdHlsZS53aWR0aCB8fCAnMTAwJSc7XG4gICAgICAgICAgICAgICAgbWFwRGl2LnN0eWxlLmhlaWdodCA9IG1hcERpdi5zdHlsZS5oZWlnaHQgfHwgJzQwMHB4JztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGQgY2xpY2sgaGFuZGxlciB0byBzaG93IHNlbGVjdGlvbiBmcmFtZSBhbmQgdG9vbGJhclxuICAgICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgICAgLy8gUmVtb3ZlIGV4aXN0aW5nIGZyYW1lIGFuZCB0b29sYmFyXG4gICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nRnJhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VsZWN0aW9uLWZyYW1lJyk7XG4gICAgICAgICAgICAgIGlmIChleGlzdGluZ0ZyYW1lKSBleGlzdGluZ0ZyYW1lLnJlbW92ZSgpO1xuICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ1Rvb2xiYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJvbC10b29sYmFyJyk7XG4gICAgICAgICAgICAgIGlmIChleGlzdGluZ1Rvb2xiYXIpIGV4aXN0aW5nVG9vbGJhci5yZW1vdmUoKTtcblxuICAgICAgICAgICAgICAvLyBDcmVhdGUgc2VsZWN0aW9uIGZyYW1lXG4gICAgICAgICAgICAgIGNvbnN0IHJlY3QgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgICAgY29uc3QgZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgZnJhbWUuY2xhc3NOYW1lID0gJ3NlbGVjdGlvbi1mcmFtZSc7XG4gICAgICAgICAgICAgIGZyYW1lLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICAgICAgICAgICAgZnJhbWUuc3R5bGUudG9wID0gKHJlY3QudG9wIC0gMiArIHdpbmRvdy5zY3JvbGxZKSArICdweCc7XG4gICAgICAgICAgICAgIGZyYW1lLnN0eWxlLmxlZnQgPSAocmVjdC5sZWZ0IC0gMiArIHdpbmRvdy5zY3JvbGxYKSArICdweCc7XG4gICAgICAgICAgICAgIGZyYW1lLnN0eWxlLndpZHRoID0gKHJlY3Qud2lkdGggKyA0KSArICdweCc7XG4gICAgICAgICAgICAgIGZyYW1lLnN0eWxlLmhlaWdodCA9IChyZWN0LmhlaWdodCArIDQpICsgJ3B4JztcbiAgICAgICAgICAgICAgZnJhbWUuc3R5bGUuYm9yZGVyID0gJzJweCBzb2xpZCAjMDA3YmZmJztcbiAgICAgICAgICAgICAgZnJhbWUuc3R5bGUuekluZGV4ID0gJzk5OSc7XG4gICAgICAgICAgICAgIGZyYW1lLnNldEF0dHJpYnV0ZSgnZGF0YS10YXJnZXQtaWQnLCAnZHJhZy0nICsgaW5kZXgpO1xuICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZyYW1lKTtcblxuICAgICAgICAgICAgICAvLyBDcmVhdGUgdG9vbGJhclxuICAgICAgICAgICAgICBjb25zdCB0b29sYmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICAgIHRvb2xiYXIuY2xhc3NOYW1lID0gJ2NvbnRyb2wtdG9vbGJhcic7XG4gICAgICAgICAgICAgIHRvb2xiYXIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgICAgICAgICAgICB0b29sYmFyLnN0eWxlLnRvcCA9IChyZWN0LnRvcCAtIDQwICsgd2luZG93LnNjcm9sbFkpICsgJ3B4JztcbiAgICAgICAgICAgICAgdG9vbGJhci5zdHlsZS5sZWZ0ID0gKHJlY3QubGVmdCArIHJlY3Qud2lkdGggLyAyIC0gMTAwICsgd2luZG93LnNjcm9sbFgpICsgJ3B4JztcbiAgICAgICAgICAgICAgdG9vbGJhci5zdHlsZS5iYWNrZ3JvdW5kID0gJyNmZmYnO1xuICAgICAgICAgICAgICB0b29sYmFyLnN0eWxlLmJvcmRlciA9ICcxcHggc29saWQgI2RkZCc7XG4gICAgICAgICAgICAgIHRvb2xiYXIuc3R5bGUuYm9yZGVyUmFkaXVzID0gJzhweCc7XG4gICAgICAgICAgICAgIHRvb2xiYXIuc3R5bGUucGFkZGluZyA9ICc0cHgnO1xuICAgICAgICAgICAgICB0b29sYmFyLnN0eWxlLmJveFNoYWRvdyA9ICcwIDJweCA1cHggcmdiYSgwLDAsMCwwLjEpJztcbiAgICAgICAgICAgICAgdG9vbGJhci5zdHlsZS56SW5kZXggPSAnMTAwMCc7XG4gICAgICAgICAgICAgIHRvb2xiYXIuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgICAgICAgdG9vbGJhci5zdHlsZS5nYXAgPSAnNHB4JztcblxuICAgICAgICAgICAgICBjb25zdCBpY29ucyA9IFtcbiAgICAgICAgICAgICAgICB7IHRpdGxlOiAnRWRpdCcsIGljb246ICfinI/vuI8nIH0sXG4gICAgICAgICAgICAgICAgeyB0aXRsZTogJ0xvY2snLCBpY29uOiAn8J+UkicgfSxcbiAgICAgICAgICAgICAgICB7IHRpdGxlOiAnRHVwbGljYXRlJywgaWNvbjogJ/Cfk4snIH0sXG4gICAgICAgICAgICAgICAgeyB0aXRsZTogJ0RlbGV0ZScsIGljb246ICfwn5eR77iPJyB9LFxuICAgICAgICAgICAgICAgIHsgdGl0bGU6ICdNb3JlJywgaWNvbjogJ+KLrycgfSxcbiAgICAgICAgICAgICAgICB7IHRpdGxlOiAnQWRkIEltYWdlJywgaWNvbjogJ/CflrzvuI8nIH1cbiAgICAgICAgICAgICAgXS5tYXAoaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgICAgICAgICAgYnRuLmlubmVySFRNTCA9IGl0ZW0uaWNvbjtcbiAgICAgICAgICAgICAgICBidG4udGl0bGUgPSBpdGVtLnRpdGxlO1xuICAgICAgICAgICAgICAgIGJ0bi5zdHlsZS5ib3JkZXIgPSAnbm9uZSc7XG4gICAgICAgICAgICAgICAgYnRuLnN0eWxlLmJhY2tncm91bmQgPSAnbm9uZSc7XG4gICAgICAgICAgICAgICAgYnRuLnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJztcbiAgICAgICAgICAgICAgICBidG4uc3R5bGUuZm9udFNpemUgPSAnMTZweCc7XG4gICAgICAgICAgICAgICAgYnRuLnN0eWxlLnBhZGRpbmcgPSAnNHB4JztcbiAgICAgICAgICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnRpdGxlID09PSAnRGVsZXRlJykge1xuICAgICAgICAgICAgICAgICAgICBlbC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgZnJhbWUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRvb2xiYXIucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udGl0bGUgPT09ICdEdXBsaWNhdGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb25lID0gZWwuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50Q291bnRlcisrO1xuICAgICAgICAgICAgICAgICAgICBjbG9uZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtZHJhZy1pZCcsICdkcmFnLScgKyBlbGVtZW50Q291bnRlcik7XG4gICAgICAgICAgICAgICAgICAgIGVsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGNsb25lLCBlbC5uZXh0U2libGluZyk7XG4gICAgICAgICAgICAgICAgICAgIGZyYW1lLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB0b29sYmFyLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnRpdGxlID09PSAnQWRkIEltYWdlJykge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHsgdHlwZTogJ3VwbG9hZC1pbWFnZScgfSwgJyonKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0hUTUwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub3V0ZXJIVE1MO1xuICAgICAgICAgICAgICAgICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7IHR5cGU6ICd1cGRhdGUtaHRtbCcsIGh0bWw6IG5ld0hUTUwgfSwgJyonKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnRuO1xuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICBpY29ucy5mb3JFYWNoKGJ0biA9PiB0b29sYmFyLmFwcGVuZENoaWxkKGJ0bikpO1xuICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRvb2xiYXIpO1xuXG4gICAgICAgICAgICAgIC8vIEhpZGUgZnJhbWUgYW5kIHRvb2xiYXIgd2hlbiBjbGlja2luZyBvdXRzaWRlXG4gICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gaGlkZUZyYW1lKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWZyYW1lLmNvbnRhaW5zKGUudGFyZ2V0KSAmJiAhZWwuY29udGFpbnMoZS50YXJnZXQpICYmICF0b29sYmFyLmNvbnRhaW5zKGUudGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgICAgZnJhbWUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICB0b29sYmFyLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoaWRlRnJhbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSwgeyBvbmNlOiB0cnVlIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZHJhZ2dlZEVsZW1lbnQgPSBudWxsO1xuICAgICAgICBsZXQgZHJvcFRhcmdldCA9IG51bGw7XG4gICAgICAgIGxldCBpc0RyYWdnaW5nID0gZmFsc2U7XG4gICAgICAgIGxldCBpc1Jlc2l6aW5nID0gZmFsc2U7XG4gICAgICAgIGxldCByZXNpemVUYXJnZXQgPSBudWxsO1xuICAgICAgICBsZXQgc3RhcnRYLCBzdGFydFksIHN0YXJ0V2lkdGgsIHN0YXJ0SGVpZ2h0O1xuICAgICAgICBsZXQgcmVzaXplRWRnZSA9ICcnO1xuXG4gICAgICAgIC8vIERyYWctYW5kLWRyb3AgZnVuY3Rpb25hbGl0eVxuICAgICAgICBjb25zdCBoYW5kbGVEcmFnU3RhcnQgPSAoZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0LmNsb3Nlc3QoJ1tkcmFnZ2FibGU9XCJ0cnVlXCJdJyk7XG4gICAgICAgICAgaWYgKHRhcmdldCAmJiAhaXNSZXNpemluZyAmJiAoKHRhcmdldC50ZXh0Q29udGVudCAmJiB0YXJnZXQudGV4dENvbnRlbnQudHJpbSgpKSB8fCB0YXJnZXQudGFnTmFtZSA9PT0gJ0lNRycgfHwgdGFyZ2V0LnRhZ05hbWUgPT09ICdCVVRUT04nIHx8ICh0YXJnZXQudGFnTmFtZSA9PT0gJ1NFQ1RJT04nICYmIHRhcmdldC5xdWVyeVNlbGVjdG9yKCcjbWFwJykpKSkge1xuICAgICAgICAgICAgZHJhZ2dlZEVsZW1lbnQgPSB0YXJnZXQ7XG4gICAgICAgICAgICBpc0RyYWdnaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHRhcmdldC5jbGFzc0xpc3QuYWRkKCdkcmFnZ2luZycpO1xuICAgICAgICAgICAgZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICdtb3ZlJztcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nRnJhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VsZWN0aW9uLWZyYW1lJyk7XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdGcmFtZSkgZXhpc3RpbmdGcmFtZS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nVG9vbGJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cm9sLXRvb2xiYXInKTtcbiAgICAgICAgICAgIGlmIChleGlzdGluZ1Rvb2xiYXIpIGV4aXN0aW5nVG9vbGJhci5yZW1vdmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgaGFuZGxlRHJhZ092ZXIgPSAoZSkgPT4ge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldC5jbG9zZXN0KCdbZHJhZ2dhYmxlPVwidHJ1ZVwiXScpO1xuICAgICAgICAgIGlmIChkcmFnZ2VkRWxlbWVudCAmJiB0YXJnZXQgIT09IGRyYWdnZWRFbGVtZW50ICYmICgodGFyZ2V0LnRleHRDb250ZW50ICYmIHRhcmdldC50ZXh0Q29udGVudC50cmltKCkpIHx8IHRhcmdldC50YWdOYW1lID09PSAnSU1HJyB8fCB0YXJnZXQudGFnTmFtZSA9PT0gJ0JVVFRPTicgfHwgKHRhcmdldC50YWdOYW1lID09PSAnU0VDVElPTicgJiYgdGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJyNtYXAnKSkpKSB7XG4gICAgICAgICAgICBkcm9wVGFyZ2V0ID0gdGFyZ2V0O1xuICAgICAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2RyYWctb3ZlcicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBoYW5kbGVEcmFnTGVhdmUgPSAoZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0LmNsb3Nlc3QoJ1tkcmFnZ2FibGU9XCJ0cnVlXCJdJyk7XG4gICAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWctb3ZlcicpO1xuICAgICAgICAgICAgZHJvcFRhcmdldCA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGhhbmRsZURyb3AgPSAoZSkgPT4ge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBjb25zdCB0YXJnZXQgPSBkcm9wVGFyZ2V0O1xuICAgICAgICAgIGlmIChkcmFnZ2VkRWxlbWVudCAmJiB0YXJnZXQgJiYgZHJhZ2dlZEVsZW1lbnQgIT09IHRhcmdldCAmJiAoKGRyYWdnZWRFbGVtZW50LnRleHRDb250ZW50ICYmIGRyYWdnZWRFbGVtZW50LnRleHRDb250ZW50LnRyaW0oKSkgfHwgZHJhZ2dlZEVsZW1lbnQudGFnTmFtZSA9PT0gJ0lNRycgfHwgZHJhZ2dlZEVsZW1lbnQudGFnTmFtZSA9PT0gJ0JVVFRPTicgfHwgKGRyYWdnZWRFbGVtZW50LnRhZ05hbWUgPT09ICdTRUNUSU9OJyAmJiBkcmFnZ2VkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjbWFwJykpKSkge1xuICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgICAgIGNvbnN0IGlzSW1hZ2VEcmFnID0gZHJhZ2dlZEVsZW1lbnQudGFnTmFtZSA9PT0gJ0lNRyc7XG4gICAgICAgICAgICAgIGNvbnN0IGlzSW1hZ2VUYXJnZXQgPSB0YXJnZXQudGFnTmFtZSA9PT0gJ0lNRyc7XG4gICAgICAgICAgICAgIGNvbnN0IGlzQnV0dG9uRHJhZyA9IGRyYWdnZWRFbGVtZW50LnRhZ05hbWUgPT09ICdCVVRUT04nO1xuICAgICAgICAgICAgICBjb25zdCBpc0J1dHRvblRhcmdldCA9IHRhcmdldC50YWdOYW1lID09PSAnQlVUVE9OJztcbiAgICAgICAgICAgICAgY29uc3QgaXNHb29nbGVNYXBTZWN0aW9uRHJhZyA9IGRyYWdnZWRFbGVtZW50LnRhZ05hbWUgPT09ICdTRUNUSU9OJyAmJiBkcmFnZ2VkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjbWFwJyk7XG4gICAgICAgICAgICAgIGNvbnN0IGlzR29vZ2xlTWFwU2VjdGlvblRhcmdldCA9IHRhcmdldC50YWdOYW1lID09PSAnU0VDVElPTicgJiYgdGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJyNtYXAnKTtcblxuICAgICAgICAgICAgICBpZiAoKGlzSW1hZ2VEcmFnICYmIGlzSW1hZ2VUYXJnZXQpIHx8IChpc0J1dHRvbkRyYWcgJiYgaXNCdXR0b25UYXJnZXQpIHx8IChpc0dvb2dsZU1hcFNlY3Rpb25EcmFnICYmIGlzR29vZ2xlTWFwU2VjdGlvblRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wSFRNTCA9IGRyYWdnZWRFbGVtZW50LmlubmVySFRNTDtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wV2lkdGggPSBkcmFnZ2VkRWxlbWVudC5zdHlsZS53aWR0aDtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wSGVpZ2h0ID0gZHJhZ2dlZEVsZW1lbnQuc3R5bGUuaGVpZ2h0O1xuICAgICAgICAgICAgICAgIGRyYWdnZWRFbGVtZW50LmlubmVySFRNTCA9IHRhcmdldC5pbm5lckhUTUw7XG4gICAgICAgICAgICAgICAgZHJhZ2dlZEVsZW1lbnQuc3R5bGUud2lkdGggPSB0YXJnZXQuc3R5bGUud2lkdGg7XG4gICAgICAgICAgICAgICAgZHJhZ2dlZEVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gdGFyZ2V0LnN0eWxlLmhlaWdodDtcbiAgICAgICAgICAgICAgICB0YXJnZXQuaW5uZXJIVE1MID0gdGVtcEhUTUw7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LnN0eWxlLndpZHRoID0gdGVtcFdpZHRoO1xuICAgICAgICAgICAgICAgIHRhcmdldC5zdHlsZS5oZWlnaHQgPSB0ZW1wSGVpZ2h0O1xuXG4gICAgICAgICAgICAgICAgaWYgKGlzR29vZ2xlTWFwU2VjdGlvbkRyYWcgfHwgaXNHb29nbGVNYXBTZWN0aW9uVGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICBbZHJhZ2dlZEVsZW1lbnQsIHRhcmdldF0uZm9yRWFjaChzZWN0aW9uID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWFwRGl2ID0gc2VjdGlvbi5xdWVyeVNlbGVjdG9yKCcjbWFwJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXBEaXYpIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzY3JpcHQgPSBzZWN0aW9uLnF1ZXJ5U2VsZWN0b3IoJ3NjcmlwdDpub3QoW3NyY10pJyk7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKHNjcmlwdCkgZXZhbChzY3JpcHQudGV4dENvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShkcmFnZ2VkRWxlbWVudCwgdGFyZ2V0KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBkcmFnZ2VkRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpO1xuICAgICAgICAgICAgICB0YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZy1vdmVyJyk7XG4gICAgICAgICAgICAgIGRyYWdnZWRFbGVtZW50ID0gbnVsbDtcbiAgICAgICAgICAgICAgZHJvcFRhcmdldCA9IG51bGw7XG5cbiAgICAgICAgICAgICAgY29uc3QgbmV3SFRNTCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vdXRlckhUTUw7XG4gICAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoeyB0eXBlOiAndXBkYXRlLWh0bWwnLCBodG1sOiBuZXdIVE1MIH0sICcqJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGhhbmRsZURyYWdFbmQgPSAoKSA9PiB7XG4gICAgICAgICAgaWYgKGRyYWdnZWRFbGVtZW50KSB7XG4gICAgICAgICAgICBkcmFnZ2VkRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpO1xuICAgICAgICAgICAgZHJhZ2dlZEVsZW1lbnQgPSBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZHJvcFRhcmdldCkge1xuICAgICAgICAgICAgZHJvcFRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnLW92ZXInKTtcbiAgICAgICAgICAgIGRyb3BUYXJnZXQgPSBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpc0RyYWdnaW5nID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQXR0YWNoIGRyYWctYW5kLWRyb3AgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGhhbmRsZURyYWdTdGFydCk7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgaGFuZGxlRHJhZ092ZXIpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnbGVhdmUnLCBoYW5kbGVEcmFnTGVhdmUpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgaGFuZGxlRHJvcCk7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCBoYW5kbGVEcmFnRW5kKTtcblxuICAgICAgICAvLyBUZXh0IGVkaXRpbmcgZm9yIGFsbCB0ZXh0LWNvbnRhaW5pbmcgZWxlbWVudHNcbiAgICAgICAgY29uc3QgdGV4dEVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgncCwgaDEsIGgyLCBoMywgaDQsIGg1LCBoNiwgc3BhbiwgYnV0dG9uJyk7XG4gICAgICAgIHRleHRFbGVtZW50cy5mb3JFYWNoKGVsID0+IHtcbiAgICAgICAgICBpZiAoZWwudGV4dENvbnRlbnQgJiYgZWwudGV4dENvbnRlbnQudHJpbSgpKSB7XG4gICAgICAgICAgICBlbC5zdHlsZS5vdmVyZmxvd1dyYXAgPSBlbC5zdHlsZS5vdmVyZmxvd1dyYXAgfHwgJ2JyZWFrLXdvcmQnO1xuICAgICAgICAgICAgZWwuc3R5bGUud29yZEJyZWFrID0gZWwuc3R5bGUud29yZEJyZWFrIHx8ICdicmVhay13b3JkJztcbiAgICAgICAgICAgIGVsLnN0eWxlLndoaXRlU3BhY2UgPSBlbC5zdHlsZS53aGl0ZVNwYWNlIHx8ICdub3JtYWwnO1xuXG4gICAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChlbC5jbGFzc0xpc3QuY29udGFpbnMoJ2VkaXRpbmcnKSkgcmV0dXJuO1xuICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdlZGl0aW5nJyk7XG5cbiAgICAgICAgICAgICAgY29uc3QgY29tcHV0ZWRTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKTtcbiAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxUZXh0ID0gZWwudGV4dENvbnRlbnQ7XG5cbiAgICAgICAgICAgICAgY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xuICAgICAgICAgICAgICB0ZXh0YXJlYS52YWx1ZSA9IG9yaWdpbmFsVGV4dDtcblxuICAgICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS53aWR0aCA9IGNvbXB1dGVkU3R5bGUud2lkdGg7XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLm1heFdpZHRoID0gY29tcHV0ZWRTdHlsZS5tYXhXaWR0aCA9PT0gJ25vbmUnID8gY29tcHV0ZWRTdHlsZS53aWR0aCA6IGNvbXB1dGVkU3R5bGUubWF4V2lkdGg7XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmhlaWdodCA9ICdhdXRvJztcbiAgICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUubWluSGVpZ2h0ID0gY29tcHV0ZWRTdHlsZS5oZWlnaHQ7XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLm1heEhlaWdodCA9IGNvbXB1dGVkU3R5bGUubWF4SGVpZ2h0ID09PSAnbm9uZScgPyAnbm9uZScgOiBjb21wdXRlZFN0eWxlLm1heEhlaWdodDtcbiAgICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUucGFkZGluZyA9IGNvbXB1dGVkU3R5bGUucGFkZGluZztcbiAgICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUubWFyZ2luID0gY29tcHV0ZWRTdHlsZS5tYXJnaW47XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmJvcmRlciA9ICcxcHggc29saWQgI2NjYyc7XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmJvcmRlclJhZGl1cyA9IGNvbXB1dGVkU3R5bGUuYm9yZGVyUmFkaXVzO1xuICAgICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5mb250RmFtaWx5ID0gY29tcHV0ZWRTdHlsZS5mb250RmFtaWx5O1xuICAgICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5mb250U2l6ZSA9IGNvbXB1dGVkU3R5bGUuZm9udFNpemU7XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmZvbnRXZWlnaHQgPSBjb21wdXRlZFN0eWxlLmZvbnRXZWlnaHQ7XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmNvbG9yID0gY29tcHV0ZWRTdHlsZS5jb2xvcjtcbiAgICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29tcHV0ZWRTdHlsZS5iYWNrZ3JvdW5kQ29sb3I7XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmxpbmVIZWlnaHQgPSBjb21wdXRlZFN0eWxlLmxpbmVIZWlnaHQ7XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLnRleHRBbGlnbiA9IGNvbXB1dGVkU3R5bGUudGV4dEFsaWduO1xuICAgICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5ib3hTaXppbmcgPSAnYm9yZGVyLWJveCc7XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLnJlc2l6ZSA9ICd2ZXJ0aWNhbCc7XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLm92ZXJmbG93V3JhcCA9ICdicmVhay13b3JkJztcbiAgICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUud29yZEJyZWFrID0gJ2JyZWFrLXdvcmQnO1xuICAgICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS53aGl0ZVNwYWNlID0gJ25vcm1hbCc7XG4gICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLm92ZXJmbG93ID0gY29tcHV0ZWRTdHlsZS5vdmVyZmxvdyA9PT0gJ3Zpc2libGUnID8gJ2F1dG8nIDogY29tcHV0ZWRTdHlsZS5vdmVyZmxvdztcblxuICAgICAgICAgICAgICBlbC50ZXh0Q29udGVudCA9ICcnO1xuICAgICAgICAgICAgICBlbC5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7XG4gICAgICAgICAgICAgIHRleHRhcmVhLmZvY3VzKCk7XG5cbiAgICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gJ2F1dG8nO1xuICAgICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5oZWlnaHQgPSBcXGBcXCR7dGV4dGFyZWEuc2Nyb2xsSGVpZ2h0fXB4XFxgO1xuXG4gICAgICAgICAgICAgIHRleHRhcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmhlaWdodCA9ICdhdXRvJztcbiAgICAgICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5oZWlnaHQgPSBcXGBcXCR7dGV4dGFyZWEuc2Nyb2xsSGVpZ2h0fXB4XFxgO1xuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICB0ZXh0YXJlYS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1RleHQgPSB0ZXh0YXJlYS52YWx1ZSB8fCBvcmlnaW5hbFRleHQ7XG4gICAgICAgICAgICAgICAgd2hpbGUgKGVsLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICAgICAgICAgIGVsLnJlbW92ZUNoaWxkKGVsLmZpcnN0Q2hpbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbC50ZXh0Q29udGVudCA9IG5ld1RleHQ7XG4gICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnZWRpdGluZycpO1xuXG4gICAgICAgICAgICAgICAgZWwuc3R5bGUub3ZlcmZsb3dXcmFwID0gJ2JyZWFrLXdvcmQnO1xuICAgICAgICAgICAgICAgIGVsLnN0eWxlLndvcmRCcmVhayA9ICdicmVhay13b3JkJztcbiAgICAgICAgICAgICAgICBlbC5zdHlsZS53aGl0ZVNwYWNlID0gJ25vcm1hbCc7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBuZXdIVE1MID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm91dGVySFRNTDtcbiAgICAgICAgICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHsgdHlwZTogJ3VwZGF0ZS1odG1sJywgaHRtbDogbmV3SFRNTCB9LCAnKicpO1xuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICB0ZXh0YXJlYS5hZGRFdmVudExpc3RlbmVyKCdrZXlwcmVzcycsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGUua2V5ID09PSAnRW50ZXInICYmICFlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICB0ZXh0YXJlYS5ibHVyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiB0aGUgbW91c2UgaXMgbmVhciBhbiBlZGdlXG4gICAgICAgIGNvbnN0IGlzTmVhckVkZ2UgPSAoZWwsIGNsaWVudFgsIGNsaWVudFkpID0+IHtcbiAgICAgICAgICBjb25zdCByZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgY29uc3QgZWRnZVRocmVzaG9sZCA9IDEwO1xuICAgICAgICAgIGNvbnN0IG5lYXJSaWdodCA9IE1hdGguYWJzKGNsaWVudFggLSByZWN0LnJpZ2h0KSA8IGVkZ2VUaHJlc2hvbGQ7XG4gICAgICAgICAgY29uc3QgbmVhckJvdHRvbSA9IE1hdGguYWJzKGNsaWVudFkgLSByZWN0LmJvdHRvbSkgPCBlZGdlVGhyZXNob2xkO1xuICAgICAgICAgIGNvbnN0IG5lYXJMZWZ0ID0gTWF0aC5hYnMoY2xpZW50WCAtIHJlY3QubGVmdCkgPCBlZGdlVGhyZXNob2xkO1xuICAgICAgICAgIGNvbnN0IG5lYXJUb3AgPSBNYXRoLmFicyhjbGllbnRZIC0gcmVjdC50b3ApIDwgZWRnZVRocmVzaG9sZDtcblxuICAgICAgICAgIGlmIChuZWFyUmlnaHQgJiYgbmVhckJvdHRvbSkgcmV0dXJuICdib3R0b20tcmlnaHQnO1xuICAgICAgICAgIGlmIChuZWFyTGVmdCAmJiBuZWFyQm90dG9tKSByZXR1cm4gJ2JvdHRvbS1sZWZ0JztcbiAgICAgICAgICBpZiAobmVhclJpZ2h0ICYmIG5lYXJUb3ApIHJldHVybiAndG9wLXJpZ2h0JztcbiAgICAgICAgICBpZiAobmVhckxlZnQgJiYgbmVhclRvcCkgcmV0dXJuICd0b3AtbGVmdCc7XG4gICAgICAgICAgaWYgKG5lYXJSaWdodCkgcmV0dXJuICdyaWdodCc7XG4gICAgICAgICAgaWYgKG5lYXJMZWZ0KSByZXR1cm4gJ2xlZnQnO1xuICAgICAgICAgIGlmIChuZWFyQm90dG9tKSByZXR1cm4gJ2JvdHRvbSc7XG4gICAgICAgICAgaWYgKG5lYXJUb3ApIHJldHVybiAndG9wJztcbiAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gRWRnZS1iYXNlZCByZXNpemluZyBvbiB0aGUgc2VsZWN0aW9uIGZyYW1lXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIChlKSA9PiB7XG4gICAgICAgICAgaWYgKGlzUmVzaXppbmcpIHJldHVybjtcblxuICAgICAgICAgIGNvbnN0IGZyYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlbGVjdGlvbi1mcmFtZScpO1xuICAgICAgICAgIGlmIChmcmFtZSkge1xuICAgICAgICAgICAgY29uc3QgZWRnZSA9IGlzTmVhckVkZ2UoZnJhbWUsIGUuY2xpZW50WCwgZS5jbGllbnRZKTtcbiAgICAgICAgICAgIGlmIChlZGdlID09PSAnYm90dG9tLXJpZ2h0JyB8fCBlZGdlID09PSAndG9wLWxlZnQnKSB7XG4gICAgICAgICAgICAgIGZyYW1lLnN0eWxlLmN1cnNvciA9ICdzZS1yZXNpemUnO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlZGdlID09PSAnYm90dG9tLWxlZnQnIHx8IGVkZ2UgPT09ICd0b3AtcmlnaHQnKSB7XG4gICAgICAgICAgICAgIGZyYW1lLnN0eWxlLmN1cnNvciA9ICdzdy1yZXNpemUnO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlZGdlID09PSAnbGVmdCcgfHwgZWRnZSA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICAgICAgICBmcmFtZS5zdHlsZS5jdXJzb3IgPSAnZXctcmVzaXplJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWRnZSA9PT0gJ3RvcCcgfHwgZWRnZSA9PT0gJ2JvdHRvbScpIHtcbiAgICAgICAgICAgICAgZnJhbWUuc3R5bGUuY3Vyc29yID0gJ25zLXJlc2l6ZSc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBmcmFtZS5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGZyYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlbGVjdGlvbi1mcmFtZScpO1xuICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWRyYWctaWQ9XCInICsgKGZyYW1lPy5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFyZ2V0LWlkJykgfHwgJycpICsgJ1wiXScpO1xuICAgICAgICAgIGlmIChmcmFtZSAmJiB0YXJnZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBpc05lYXJFZGdlKGZyYW1lLCBlLmNsaWVudFgsIGUuY2xpZW50WSk7XG4gICAgICAgICAgICBpZiAoZWRnZSkge1xuICAgICAgICAgICAgICBpc1Jlc2l6aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgcmVzaXplVGFyZ2V0ID0gdGFyZ2V0O1xuICAgICAgICAgICAgICByZXNpemVFZGdlID0gZWRnZTtcbiAgICAgICAgICAgICAgc3RhcnRYID0gZS5jbGllbnRYO1xuICAgICAgICAgICAgICBzdGFydFkgPSBlLmNsaWVudFk7XG4gICAgICAgICAgICAgIHN0YXJ0V2lkdGggPSBwYXJzZUludChnZXRDb21wdXRlZFN0eWxlKHRhcmdldCkud2lkdGgpIHx8IHRhcmdldC5vZmZzZXRXaWR0aDtcbiAgICAgICAgICAgICAgc3RhcnRIZWlnaHQgPSBwYXJzZUludChnZXRDb21wdXRlZFN0eWxlKHRhcmdldCkuaGVpZ2h0KSB8fCB0YXJnZXQub2Zmc2V0SGVpZ2h0O1xuICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCAoZSkgPT4ge1xuICAgICAgICAgIGlmICghaXNSZXNpemluZyB8fCAhcmVzaXplVGFyZ2V0KSByZXR1cm47XG5cbiAgICAgICAgICBjb25zdCBkeCA9IGUuY2xpZW50WCAtIHN0YXJ0WDtcbiAgICAgICAgICBjb25zdCBkeSA9IGUuY2xpZW50WSAtIHN0YXJ0WTtcbiAgICAgICAgICBsZXQgbmV3V2lkdGggPSBzdGFydFdpZHRoO1xuICAgICAgICAgIGxldCBuZXdIZWlnaHQgPSBzdGFydEhlaWdodDtcblxuICAgICAgICAgIGlmIChyZXNpemVFZGdlLmluY2x1ZGVzKCdyaWdodCcpKSB7XG4gICAgICAgICAgICBuZXdXaWR0aCA9IE1hdGgubWF4KDUwLCBzdGFydFdpZHRoICsgZHgpO1xuICAgICAgICAgIH0gZWxzZSBpZiAocmVzaXplRWRnZS5pbmNsdWRlcygnbGVmdCcpKSB7XG4gICAgICAgICAgICBuZXdXaWR0aCA9IE1hdGgubWF4KDUwLCBzdGFydFdpZHRoIC0gZHgpO1xuICAgICAgICAgICAgcmVzaXplVGFyZ2V0LnN0eWxlLmxlZnQgPSAocGFyc2VJbnQoZ2V0Q29tcHV0ZWRTdHlsZShyZXNpemVUYXJnZXQpLmxlZnQpIHx8IDApICsgKHN0YXJ0V2lkdGggLSBuZXdXaWR0aCkgKyAncHgnO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocmVzaXplRWRnZS5pbmNsdWRlcygnYm90dG9tJykpIHtcbiAgICAgICAgICAgIG5ld0hlaWdodCA9IE1hdGgubWF4KDUwLCBzdGFydEhlaWdodCArIGR5KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHJlc2l6ZUVkZ2UuaW5jbHVkZXMoJ3RvcCcpKSB7XG4gICAgICAgICAgICBuZXdIZWlnaHQgPSBNYXRoLm1heCg1MCwgc3RhcnRIZWlnaHQgLSBkeSk7XG4gICAgICAgICAgICByZXNpemVUYXJnZXQuc3R5bGUudG9wID0gKHBhcnNlSW50KGdldENvbXB1dGVkU3R5bGUocmVzaXplVGFyZ2V0KS50b3ApIHx8IDApICsgKHN0YXJ0SGVpZ2h0IC0gbmV3SGVpZ2h0KSArICdweCc7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmVzaXplVGFyZ2V0LnN0eWxlLndpZHRoID0gXFxgXFwke25ld1dpZHRofXB4XFxgO1xuICAgICAgICAgIHJlc2l6ZVRhcmdldC5zdHlsZS5oZWlnaHQgPSBcXGBcXCR7bmV3SGVpZ2h0fXB4XFxgO1xuXG4gICAgICAgICAgY29uc3QgbWFwRGl2ID0gcmVzaXplVGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJyNtYXAnKTtcbiAgICAgICAgICBpZiAobWFwRGl2KSB7XG4gICAgICAgICAgICBtYXBEaXYuc3R5bGUud2lkdGggPSBcXGBcXCR7bmV3V2lkdGh9cHhcXGA7XG4gICAgICAgICAgICBtYXBEaXYuc3R5bGUuaGVpZ2h0ID0gXFxgXFwke25ld0hlaWdodCAtIDUwfXB4XFxgO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBnb29nbGUgIT09ICd1bmRlZmluZWQnICYmIGdvb2dsZS5tYXBzKSB7XG4gICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIobWFwRGl2Ll9fZ21hcF9fLCAncmVzaXplJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gVXBkYXRlIHRoZSBmcmFtZSBzaXplXG4gICAgICAgICAgY29uc3QgZnJhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VsZWN0aW9uLWZyYW1lJyk7XG4gICAgICAgICAgaWYgKGZyYW1lKSB7XG4gICAgICAgICAgICBmcmFtZS5zdHlsZS53aWR0aCA9IChuZXdXaWR0aCArIDQpICsgJ3B4JztcbiAgICAgICAgICAgIGZyYW1lLnN0eWxlLmhlaWdodCA9IChuZXdIZWlnaHQgKyA0KSArICdweCc7XG4gICAgICAgICAgICBmcmFtZS5zdHlsZS5sZWZ0ID0gKHJlc2l6ZVRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0IC0gMiArIHdpbmRvdy5zY3JvbGxYKSArICdweCc7XG4gICAgICAgICAgICBmcmFtZS5zdHlsZS50b3AgPSAocmVzaXplVGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAtIDIgKyB3aW5kb3cuc2Nyb2xsWSkgKyAncHgnO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsICgpID0+IHtcbiAgICAgICAgICBpZiAoaXNSZXNpemluZykge1xuICAgICAgICAgICAgaXNSZXNpemluZyA9IGZhbHNlO1xuICAgICAgICAgICAgY29uc3QgbmV3SFRNTCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vdXRlckhUTUw7XG4gICAgICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHsgdHlwZTogJ3VwZGF0ZS1odG1sJywgaHRtbDogbmV3SFRNTCB9LCAnKicpO1xuICAgICAgICAgICAgcmVzaXplVGFyZ2V0LnN0eWxlLmN1cnNvciA9ICdtb3ZlJztcbiAgICAgICAgICAgIHJlc2l6ZVRhcmdldCA9IG51bGw7XG4gICAgICAgICAgICByZXNpemVFZGdlID0gJyc7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIDwvc2NyaXB0PlxuICAgIDxzdHlsZT5cbiAgICAgIC5kcmFnZ2luZyB7XG4gICAgICAgIG9wYWNpdHk6IDAuNTtcbiAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjIpO1xuICAgICAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuM3MsIHRyYW5zZm9ybSAwLjJzIGVhc2UtaW4tb3V0O1xuICAgICAgICBib3JkZXI6IDJweCBkYXNoZWQgIzAwN2JmZjtcbiAgICAgIH1cbiAgICAgIC5kcmFnLW92ZXIge1xuICAgICAgICBiYWNrZ3JvdW5kOiAjYTVkNmE3O1xuICAgICAgICBib3JkZXI6IDJweCBkYXNoZWQgIzRjYWY1MDtcbiAgICAgIH1cbiAgICAgIFtkcmFnZ2FibGU9XCJ0cnVlXCJdIHtcbiAgICAgICAgcGFkZGluZzogMC41cmVtO1xuICAgICAgICBtYXJnaW46IDAuNXJlbTtcbiAgICAgICAgY3Vyc29yOiBncmFiO1xuICAgICAgfVxuICAgICAgW2RyYWdnYWJsZT1cInRydWVcIl0uZHJhZ2dpbmcge1xuICAgICAgICBjdXJzb3I6IGdyYWJiaW5nO1xuICAgICAgfVxuICAgICAgLmVkaXRpbmcge1xuICAgICAgICBib3JkZXI6IDFweCBkYXNoZWQgIzAwN2JmZjtcbiAgICAgICAgcGFkZGluZzogNXB4O1xuICAgICAgfVxuICAgICAgaW1nLCBkaXYsIHNlY3Rpb24sIGFydGljbGUsIGFzaWRlLCBmaWd1cmUsIGJ1dHRvbiB7XG4gICAgICAgIG1pbi13aWR0aDogNTBweDtcbiAgICAgICAgbWluLWhlaWdodDogNTBweDtcbiAgICAgIH1cbiAgICAgIHNlY3Rpb246aGFzKCNtYXApIHtcbiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2RkZDtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4O1xuICAgICAgICBwYWRkaW5nOiAxMHB4O1xuICAgICAgICBib3gtc2hhZG93OiAwIDJweCA1cHggcmdiYSgwLDAsMCwwLjEpO1xuICAgICAgfVxuICAgICAgLmNvbnRyb2wtdG9vbGJhciBidXR0b246aG92ZXIge1xuICAgICAgICBiYWNrZ3JvdW5kOiAjZjBmMGYwO1xuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICB9XG4gICAgICAuc2VsZWN0aW9uLWZyYW1lIHtcbiAgICAgICAgcG9pbnRlci1ldmVudHM6IGF1dG87XG4gICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gICAgICB9XG4gICAgPC9zdHlsZT5cbiAgYDtcblxuICAvLyBQcm9jZXNzIEhUTUwgd2l0aCBuYXZpZ2F0aW9uIGFuZCBkcmFnLWFuZC1kcm9wIHNjcmlwdHNcbiAgY29uc3QgcHJvY2Vzc0hUTUwgPSB1c2VDYWxsYmFjaygoaHRtbDogc3RyaW5nLCBwYWdlTGlzdDogc3RyaW5nW10pOiBzdHJpbmcgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XG4gICAgICBjb25zdCBkb2MgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKGh0bWwsICd0ZXh0L2h0bWwnKTtcblxuICAgICAgaWYgKCFkb2MucXVlcnlTZWxlY3Rvcignc2NyaXB0W2RhdGEtbmF2aWdhdGlvbi1oYW5kbGVyXScpKSB7XG4gICAgICAgIGNvbnN0IHNjcmlwdCA9IGRvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgICAgc2NyaXB0LnNldEF0dHJpYnV0ZSgnZGF0YS1uYXZpZ2F0aW9uLWhhbmRsZXInLCAndHJ1ZScpO1xuICAgICAgICBzY3JpcHQudGV4dENvbnRlbnQgPSBgXG4gICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2FbaHJlZiQ9XCIuaHRtbFwiXScpLmZvckVhY2gobGluayA9PiB7XG4gICAgICAgICAgICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaHJlZiA9IGxpbmsuZ2V0QXR0cmlidXRlKCdocmVmJyk7XG4gICAgICAgICAgICAgICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7IHR5cGU6ICduYXZpZ2F0aW9uJywgaHJlZiB9LCAnKicpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICBgO1xuICAgICAgICBkb2MuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWRvYy5xdWVyeVNlbGVjdG9yKCdzY3JpcHRbZGF0YS1kcmFnLWRyb3AtaGFuZGxlcl0nKSkge1xuICAgICAgICBjb25zdCBkcmFnRHJvcFNjcmlwdCA9IGRvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgICAgZHJhZ0Ryb3BTY3JpcHQuc2V0QXR0cmlidXRlKCdkYXRhLWRyYWctZHJvcC1oYW5kbGVyJywgJ3RydWUnKTtcbiAgICAgICAgZHJhZ0Ryb3BTY3JpcHQudGV4dENvbnRlbnQgPSBpbmplY3REcmFnRHJvcFNjcmlwdCgpO1xuICAgICAgICBkb2MuYm9keS5hcHBlbmRDaGlsZChkcmFnRHJvcFNjcmlwdCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG5hdiA9IGRvYy5xdWVyeVNlbGVjdG9yKCduYXYnKTtcbiAgICAgIGlmIChuYXYgJiYgcGFnZUxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCB0aGVtZSA9IG5hdi5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGhlbWUnKSB8fCAnZGlnaXRhbCc7XG4gICAgICAgIG5hdi5vdXRlckhUTUwgPSBnZXROYXZCYXIocGFnZUxpc3QsIGN1cnJlbnRQYWdlLCB0aGVtZSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAnPCFET0NUWVBFIGh0bWw+JyArIGRvYy5kb2N1bWVudEVsZW1lbnQub3V0ZXJIVE1MO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcHJvY2Vzc2luZyBIVE1MOicsIGVycik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgSFRNTCBjb250ZW50Jyk7XG4gICAgfVxuICB9LCBbY3VycmVudFBhZ2VdKTtcblxuICAvLyBOYXZpZ2F0aW9uIGJhciBnZW5lcmF0b3JcbiAgZnVuY3Rpb24gZ2V0TmF2QmFyKHBhZ2VzOiBzdHJpbmdbXSwgY3VycmVudFBhZ2U6IHN0cmluZywgdGhlbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgY29sb3JzID0ge1xuICAgICAgbmF2Qmc6ICdyZ2JhKDQyLCA0MiwgNDIsIDAuOCknLFxuICAgICAgbmF2TGluazogJyNlMGUwZTAnLFxuICAgICAgbmF2QWN0aXZlOiAnI2JiODZmYycsXG4gICAgfTtcbiAgICByZXR1cm4gYFxuICAgICAgPG5hdiBzdHlsZT1cInBvc2l0aW9uOiBzdGlja3k7IHRvcDogMDsgYmFja2dyb3VuZDogJHtjb2xvcnMubmF2Qmd9OyBwYWRkaW5nOiAxcmVtIDJyZW07IHRleHQtYWxpZ246IGNlbnRlcjsgYm94LXNoYWRvdzogMCAycHggMTBweCByZ2JhKDAsIDAsIDAsIDAuMSk7IHotaW5kZXg6IDEwMDA7XCI+XG4gICAgICAgICR7cGFnZXMubWFwKHBhZ2UgPT4ge1xuICAgICAgICAgIGNvbnN0IHBhZ2VOYW1lID0gcGFnZS5yZXBsYWNlKCcuaHRtbCcsICcnKTtcbiAgICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IHBhZ2UgPT09IGN1cnJlbnRQYWdlO1xuICAgICAgICAgIGNvbnN0IGFjdGl2ZVN0eWxlID0gaXNBY3RpdmUgPyBgY29sb3I6ICR7Y29sb3JzLm5hdkFjdGl2ZX07IGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAke2NvbG9ycy5uYXZBY3RpdmV9O2AgOiAnJztcbiAgICAgICAgICByZXR1cm4gYDxhIGhyZWY9XCIke3BhZ2V9XCIgc3R5bGU9XCJjb2xvcjogJHtjb2xvcnMubmF2TGlua307IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgbWFyZ2luOiAwIDEuNXJlbTsgZm9udC13ZWlnaHQ6IDYwMDsgJHthY3RpdmVTdHlsZX1cIj4ke3BhZ2VOYW1lfTwvYT5gO1xuICAgICAgICB9KS5qb2luKCcnKX1cbiAgICAgIDwvbmF2PlxuICAgIGA7XG4gIH1cblxuICAvLyBIYW5kbGUgZHJhZy1hbmQtZHJvcCBldmVudHMgZm9yIGZpbGUgdXBsb2Fkc1xuICBjb25zdCBoYW5kbGVEcmFnT3ZlciA9IHVzZUNhbGxiYWNrKChlOiBSZWFjdC5EcmFnRXZlbnQ8SFRNTERpdkVsZW1lbnQ+KSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgc2V0SXNEcmFnT3Zlcih0cnVlKTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IGhhbmRsZURyYWdMZWF2ZSA9IHVzZUNhbGxiYWNrKChlOiBSZWFjdC5EcmFnRXZlbnQ8SFRNTERpdkVsZW1lbnQ+KSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgc2V0SXNEcmFnT3ZlcihmYWxzZSk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBoYW5kbGVEcm9wID0gdXNlQ2FsbGJhY2soYXN5bmMgKGU6IFJlYWN0LkRyYWdFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBzZXRJc0RyYWdPdmVyKGZhbHNlKTtcblxuICAgIGNvbnN0IGZpbGVzID0gZS5kYXRhVHJhbnNmZXIuZmlsZXM7XG4gICAgaWYgKGZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGZpbGUgPSBmaWxlc1swXTtcbiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICByZWFkZXIub25sb2FkID0gKGV2ZW50KSA9PiB7XG4gICAgICAgIGlmIChldmVudC50YXJnZXQgJiYgdHlwZW9mIGV2ZW50LnRhcmdldC5yZXN1bHQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgaWYgKG9uRmlsZVVwbG9hZCkgb25GaWxlVXBsb2FkKGZpbGUsIGV2ZW50LnRhcmdldC5yZXN1bHQpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7XG4gICAgfVxuICB9LCBbb25GaWxlVXBsb2FkXSk7XG5cbiAgLy8gVXBkYXRlIGlmcmFtZSBjb250ZW50IHdpdGggZGVib3VuY2luZ1xuICBjb25zdCB1cGRhdGVJZnJhbWUgPSB1c2VNZW1vKFxuICAgICgpID0+XG4gICAgICBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICAgIGNvbnN0IGlmcmFtZSA9IGlmcmFtZVJlZi5jdXJyZW50O1xuICAgICAgICBpZiAoIWlmcmFtZSB8fCAhcGFnZXNbY3VycmVudFBhZ2VdKSB7XG4gICAgICAgICAgc2V0RXJyb3IoJ1BhZ2Ugbm90IGZvdW5kIG9yIGlmcmFtZSB1bmF2YWlsYWJsZScpO1xuICAgICAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgICAgICAgaWYgKGlmcmFtZSAmJiBsYXN0VmFsaWRIVE1MKSBpZnJhbWUuc3JjZG9jID0gbGFzdFZhbGlkSFRNTDtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBzZXRJc0xvYWRpbmcodHJ1ZSk7XG4gICAgICAgIHNldEVycm9yKG51bGwpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgY2xlYW5lZEhUTUwgPSBjbGVhbkNvZGUocGFnZXNbY3VycmVudFBhZ2VdLCBjdXJyZW50UGFnZSk7XG4gICAgICAgICAgY29uc3QgcGFnZUxpc3QgPSBPYmplY3Qua2V5cyhwYWdlcyk7XG4gICAgICAgICAgY29uc3QgcHJvY2Vzc2VkSFRNTCA9IHByb2Nlc3NIVE1MKGNsZWFuZWRIVE1MICsgaW5qZWN0RHJhZ0Ryb3BTY3JpcHQoKSwgcGFnZUxpc3QpO1xuICAgICAgICAgIGlmcmFtZS5zcmNkb2MgPSBwcm9jZXNzZWRIVE1MO1xuICAgICAgICAgIHNldExhc3RWYWxpZEhUTUwocHJvY2Vzc2VkSFRNTCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIHNldEVycm9yKCdGYWlsZWQgdG8gbG9hZCBwYWdlIGNvbnRlbnQ6ICcgKyAoZXJyIGluc3RhbmNlb2YgRXJyb3IgPyBlcnIubWVzc2FnZSA6IFN0cmluZyhlcnIpKSk7XG4gICAgICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgICBpZiAoaWZyYW1lICYmIGxhc3RWYWxpZEhUTUwpIGlmcmFtZS5zcmNkb2MgPSBsYXN0VmFsaWRIVE1MO1xuICAgICAgICB9XG4gICAgICB9LCAzMDApLFxuICAgIFtjdXJyZW50UGFnZSwgcGFnZXMsIHByb2Nlc3NIVE1MLCBjbGVhbkNvZGUsIGxhc3RWYWxpZEhUTUxdXG4gICk7XG5cbiAgLy8gSGFuZGxlIGlmcmFtZSB1cGRhdGVzIGFuZCBtZXNzYWdlc1xuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHVwZGF0ZUlmcmFtZSgpO1xuXG4gICAgY29uc3QgaWZyYW1lID0gaWZyYW1lUmVmLmN1cnJlbnQ7XG4gICAgaWYgKCFpZnJhbWUpIHJldHVybjtcblxuICAgIGNvbnN0IGhhbmRsZUxvYWQgPSAoKSA9PiBzZXRJc0xvYWRpbmcoZmFsc2UpO1xuICAgIGlmcmFtZS5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgaGFuZGxlTG9hZCk7XG5cbiAgICBjb25zdCBoYW5kbGVNZXNzYWdlID0gYXN5bmMgKGV2ZW50OiBNZXNzYWdlRXZlbnQpID0+IHtcbiAgICAgIGlmIChldmVudC5vcmlnaW4gIT09ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnKSByZXR1cm47IC8vIFNlY3VyaXR5IGNoZWNrXG4gICAgICBpZiAoZXZlbnQuZGF0YT8udHlwZSA9PT0gJ25hdmlnYXRpb24nICYmIHR5cGVvZiBldmVudC5kYXRhLmhyZWYgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGlmIChwYWdlc1tldmVudC5kYXRhLmhyZWZdKSB7XG4gICAgICAgICAgc2V0TG9jYWxQYWdlKGV2ZW50LmRhdGEuaHJlZik7XG4gICAgICAgICAgb25QYWdlQ2hhbmdlPy4oZXZlbnQuZGF0YS5ocmVmKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBzZXRFcnJvcihgUGFnZSBcIiR7ZXZlbnQuZGF0YS5ocmVmfVwiIG5vdCBmb3VuZGApO1xuICAgICAgICAgIGNvbnN0IGZhbGxiYWNrUGFnZSA9IE9iamVjdC5rZXlzKHBhZ2VzKS5maWx0ZXIocGFnZSA9PiBwYWdlLmVuZHNXaXRoKCcuaHRtbCcpKVswXSB8fCAnJztcbiAgICAgICAgICBzZXRMb2NhbFBhZ2UoZmFsbGJhY2tQYWdlKTtcbiAgICAgICAgICBvblBhZ2VDaGFuZ2U/LihmYWxsYmFja1BhZ2UpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGV2ZW50LmRhdGE/LnR5cGUgPT09ICdmaWxlLWRyb3AnKSB7XG4gICAgICAgIGlmIChvbkZpbGVVcGxvYWQpIHtcbiAgICAgICAgICBjb25zdCBmaWxlQ29udGVudCA9IGV2ZW50LmRhdGEuZmlsZUNvbnRlbnQ7XG4gICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBldmVudC5kYXRhLmZpbGVOYW1lO1xuICAgICAgICAgIGlmICh0eXBlb2YgZmlsZUNvbnRlbnQgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBmaWxlTmFtZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBuZXcgRmlsZShbZmlsZUNvbnRlbnRdLCBmaWxlTmFtZSwgeyB0eXBlOiAndGV4dC9odG1sJyB9KTtcbiAgICAgICAgICAgIG9uRmlsZVVwbG9hZChmaWxlLCBmaWxlQ29udGVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGV2ZW50LmRhdGE/LnR5cGUgPT09ICd1cGRhdGUtaHRtbCcpIHtcbiAgICAgICAgY29uc3QgbmV3SFRNTCA9IGV2ZW50LmRhdGEuaHRtbDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwOi8vbG9jYWxob3N0OjUwMDAvYXBpL3NhdmUtcGFnZScsIHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHBhZ2VQYXRoOiBjdXJyZW50UGFnZSwgY29kZTogbmV3SFRNTCB9KSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhUVFAgZXJyb3IhIHN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICBwYWdlc1tjdXJyZW50UGFnZV0gPSBuZXdIVE1MOyAvLyBVcGRhdGUgbG9jYWwgc3RhdGVcbiAgICAgICAgICB1cGRhdGVJZnJhbWUoKTsgLy8gUmVmcmVzaCBpZnJhbWVcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgc2V0RXJyb3IoYEZhaWxlZCB0byBzYXZlIHVwZGF0ZWQgSFRNTDogJHtlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogU3RyaW5nKGVycil9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBoYW5kbGVNZXNzYWdlKTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgaWZyYW1lLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBoYW5kbGVMb2FkKTtcbiAgICAgIHVwZGF0ZUlmcmFtZS5jYW5jZWwoKTtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgaGFuZGxlTWVzc2FnZSk7XG4gICAgfTtcbiAgfSwgW2N1cnJlbnRQYWdlLCBwYWdlcywgdXBkYXRlSWZyYW1lLCBvbkZpbGVVcGxvYWRdKTtcblxuICAvLyBWYWxpZGF0ZSBpbml0aWFsIHBhZ2VcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoIXBhZ2VzW2N1cnJlbnRQYWdlXSkge1xuICAgICAgc2V0RXJyb3IoYFBhZ2UgXCIke2N1cnJlbnRQYWdlfVwiIG5vdCBmb3VuZGApO1xuICAgICAgY29uc3QgZmlyc3RQYWdlID0gT2JqZWN0LmtleXMocGFnZXMpLmZpbHRlcihwYWdlID0+IHBhZ2UuZW5kc1dpdGgoJy5odG1sJykpWzBdIHx8ICcnO1xuICAgICAgaWYgKCFsb2NhbFBhZ2UgJiYgZmlyc3RQYWdlKSB7XG4gICAgICAgIHNldExvY2FsUGFnZShmaXJzdFBhZ2UpO1xuICAgICAgICBvblBhZ2VDaGFuZ2U/LihmaXJzdFBhZ2UpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoIWxvY2FsUGFnZSkge1xuICAgICAgc2V0TG9jYWxQYWdlKGN1cnJlbnRQYWdlKTtcbiAgICB9XG4gIH0sIFtjdXJyZW50UGFnZSwgcGFnZXNdKTtcblxuICByZXR1cm4gKFxuICAgIDxkaXZcbiAgICAgIHJlZj17ZHJvcFpvbmVSZWZ9XG4gICAgICBvbkRyYWdPdmVyPXtoYW5kbGVEcmFnT3Zlcn1cbiAgICAgIG9uRHJhZ0xlYXZlPXtoYW5kbGVEcmFnTGVhdmV9XG4gICAgICBvbkRyb3A9e2hhbmRsZURyb3B9XG4gICAgICBjbGFzc05hbWU9e2ByZWxhdGl2ZSBoLWZ1bGwgdy1mdWxsIHJvdW5kZWQtbGcgYm9yZGVyIGJvcmRlci1ncmF5LTIwMCBiZy13aGl0ZSBzaGFkb3ctc20gb3ZlcmZsb3ctaGlkZGVuIHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTMwMCAke2lzRHJhZ092ZXIgPyAnYm9yZGVyLXB1cnBsZS01MDAgYm9yZGVyLTQnIDogJyd9YH1cbiAgICA+XG4gICAgICB7aXNEcmFnT3ZlciAmJiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYWJzb2x1dGUgaW5zZXQtMCBiZy1wdXJwbGUtNTAwIGJnLW9wYWNpdHktNTAgei01MCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlclwiPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC13aGl0ZSB0ZXh0LTJ4bCBmb250LWJvbGRcIj5Ecm9wIHlvdXIgZmlsZSBoZXJlPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKX1cbiAgICAgIHtpc0xvYWRpbmcgJiYgKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImFic29sdXRlIGluc2V0LTAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgYmctd2hpdGUvODAgei0xMCB0cmFuc2l0aW9uLW9wYWNpdHkgZHVyYXRpb24tMjAwXCI+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJhbmltYXRlLXNwaW4gcm91bmRlZC1mdWxsIGgtMTAgdy0xMCBib3JkZXItdC0yIGJvcmRlci1iLTIgYm9yZGVyLXB1cnBsZS02MDBcIj48L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICApfVxuICAgICAge2Vycm9yICYmIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJhYnNvbHV0ZSBpbnNldC0wIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGJnLXJlZC01MCB6LTEwIHAtNFwiPlxuICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtcmVkLTYwMCBmb250LW1lZGl1bSB0ZXh0LXNtXCI+e2Vycm9yfTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgICApfVxuICAgICAgPGlmcmFtZVxuICAgICAgICByZWY9e2lmcmFtZVJlZn1cbiAgICAgICAgdGl0bGU9XCJMaXZlIFByZXZpZXdcIlxuICAgICAgICBjbGFzc05hbWU9XCJ3LWZ1bGwgaC1mdWxsIGJnLXdoaXRlXCJcbiAgICAgICAgc2FuZGJveD1cImFsbG93LXNjcmlwdHMgYWxsb3ctc2FtZS1vcmlnaW4gYWxsb3ctcG9wdXBzXCJcbiAgICAgICAgb25FcnJvcj17KCkgPT4gc2V0RXJyb3IoJ0ZhaWxlZCB0byBsb2FkIGlmcmFtZSBjb250ZW50Jyl9XG4gICAgICAvPlxuICAgIDwvZGl2PlxuICApO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgTGl2ZVByZXZpZXc7Il0sIm5hbWVzIjpbIlJlYWN0IiwidXNlRWZmZWN0IiwidXNlUmVmIiwidXNlU3RhdGUiLCJ1c2VDYWxsYmFjayIsInVzZU1lbW8iLCJkZWJvdW5jZSIsIkxpdmVQcmV2aWV3IiwicGFnZXMiLCJjdXJyZW50UGFnZSIsIm9uUGFnZUNoYW5nZSIsIm9uRmlsZVVwbG9hZCIsImxvY2FsUGFnZSIsInNldExvY2FsUGFnZSIsImlzTG9hZGluZyIsInNldElzTG9hZGluZyIsImlzRHJhZ092ZXIiLCJzZXRJc0RyYWdPdmVyIiwiZXJyb3IiLCJzZXRFcnJvciIsImxhc3RWYWxpZEhUTUwiLCJzZXRMYXN0VmFsaWRIVE1MIiwiaWZyYW1lUmVmIiwiZHJvcFpvbmVSZWYiLCJoYW5kbGVJbWFnZVVwbG9hZCIsImlucHV0IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwidHlwZSIsImFjY2VwdCIsIm11bHRpcGxlIiwib25jaGFuZ2UiLCJldmVudCIsImZpbGVzIiwidGFyZ2V0IiwibGVuZ3RoIiwiZm9ybURhdGEiLCJGb3JtRGF0YSIsIkFycmF5IiwiZnJvbSIsImZvckVhY2giLCJmaWxlIiwiYXBwZW5kIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImJvZHkiLCJvayIsIkVycm9yIiwiZGF0YSIsImpzb24iLCJuZXdIVE1MIiwiZG9jdW1lbnRFbGVtZW50Iiwib3V0ZXJIVE1MIiwid2luZG93IiwicGFyZW50IiwicG9zdE1lc3NhZ2UiLCJodG1sIiwiY29uc29sZSIsImFsZXJ0IiwiY2xpY2siLCJjbGVhbkNvZGUiLCJodG1sQ29kZSIsInBhZ2VOYW1lIiwiY2xlYW5lZCIsInJlcGxhY2UiLCJ0cmltIiwic3RhcnRzV2l0aCIsImluY2x1ZGVzIiwiZW5kc1dpdGgiLCJlcnIiLCJpbmplY3REcmFnRHJvcFNjcmlwdCIsInByb2Nlc3NIVE1MIiwicGFnZUxpc3QiLCJwYXJzZXIiLCJET01QYXJzZXIiLCJkb2MiLCJwYXJzZUZyb21TdHJpbmciLCJxdWVyeVNlbGVjdG9yIiwic2NyaXB0Iiwic2V0QXR0cmlidXRlIiwidGV4dENvbnRlbnQiLCJhcHBlbmRDaGlsZCIsImRyYWdEcm9wU2NyaXB0IiwibmF2IiwidGhlbWUiLCJnZXRBdHRyaWJ1dGUiLCJnZXROYXZCYXIiLCJjb2xvcnMiLCJuYXZCZyIsIm5hdkxpbmsiLCJuYXZBY3RpdmUiLCJtYXAiLCJwYWdlIiwiaXNBY3RpdmUiLCJhY3RpdmVTdHlsZSIsImpvaW4iLCJoYW5kbGVEcmFnT3ZlciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsImhhbmRsZURyYWdMZWF2ZSIsImhhbmRsZURyb3AiLCJkYXRhVHJhbnNmZXIiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwicmVzdWx0IiwicmVhZEFzVGV4dCIsInVwZGF0ZUlmcmFtZSIsImlmcmFtZSIsImN1cnJlbnQiLCJzcmNkb2MiLCJjbGVhbmVkSFRNTCIsIk9iamVjdCIsImtleXMiLCJwcm9jZXNzZWRIVE1MIiwibWVzc2FnZSIsIlN0cmluZyIsImhhbmRsZUxvYWQiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlTWVzc2FnZSIsIm9yaWdpbiIsImhyZWYiLCJmYWxsYmFja1BhZ2UiLCJmaWx0ZXIiLCJmaWxlQ29udGVudCIsImZpbGVOYW1lIiwiRmlsZSIsImhlYWRlcnMiLCJKU09OIiwic3RyaW5naWZ5IiwicGFnZVBhdGgiLCJjb2RlIiwic3RhdHVzIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImNhbmNlbCIsImZpcnN0UGFnZSIsImRpdiIsInJlZiIsIm9uRHJhZ092ZXIiLCJvbkRyYWdMZWF2ZSIsIm9uRHJvcCIsImNsYXNzTmFtZSIsInAiLCJ0aXRsZSIsInNhbmRib3giLCJvbkVycm9yIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(app-pages-browser)/./src/components/LivePreview.tsx\n"));

/***/ })

});